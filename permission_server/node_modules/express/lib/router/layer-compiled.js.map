{"version":3,"sources":["layer.js"],"names":[],"mappings":"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","file":"layer-compiled.js","sourcesContent":["/**\n * Module dependencies.\n */\n\nvar pathRegexp = require('path-to-regexp');\nvar debug = require('debug')('express:router:layer');\n\n/**\n * Module variables.\n */\n\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\n\n/**\n * Expose `Layer`.\n */\n\nmodule.exports = Layer;\n\nfunction Layer(path, options, fn) {\n  if (!(this instanceof Layer)) {\n    return new Layer(path, options, fn);\n  }\n\n  debug('new %s', path);\n  options = options || {};\n\n  this.handle = fn;\n  this.name = fn.name || '<anonymous>';\n  this.params = undefined;\n  this.path = undefined;\n  this.regexp = pathRegexp(path, this.keys = [], options);\n\n  if (path === '/' && options.end === false) {\n    this.regexp.fast_slash = true;\n  }\n}\n\n/**\n * Handle the error for the layer.\n *\n * @param {Error} error\n * @param {Request} req\n * @param {Response} res\n * @param {function} next\n * @api private\n */\n\nLayer.prototype.handle_error = function handle_error(error, req, res, next) {\n  var fn = this.handle;\n\n  if (fn.length !== 4) {\n    // not a standard error handler\n    return next(error);\n  }\n\n  try {\n    fn(error, req, res, next);\n  } catch (err) {\n    next(err);\n  }\n};\n\n/**\n * Handle the request for the layer.\n *\n * @param {Request} req\n * @param {Response} res\n * @param {function} next\n * @api private\n */\n\nLayer.prototype.handle_request = function handle(req, res, next) {\n  var fn = this.handle;\n\n  if (fn.length > 3) {\n    // not a standard request handler\n    return next();\n  }\n\n  try {\n    fn(req, res, next);\n  } catch (err) {\n    next(err);\n  }\n};\n\n/**\n * Check if this route matches `path`, if so\n * populate `.params`.\n *\n * @param {String} path\n * @return {Boolean}\n * @api private\n */\n\nLayer.prototype.match = function match(path) {\n  if (path == null) {\n    // no path, nothing matches\n    this.params = undefined;\n    this.path = undefined;\n    return false;\n  }\n\n  if (this.regexp.fast_slash) {\n    // fast path non-ending match for / (everything matches)\n    this.params = {};\n    this.path = '';\n    return true;\n  }\n\n  var m = this.regexp.exec(path);\n\n  if (!m) {\n    this.params = undefined;\n    this.path = undefined;\n    return false;\n  }\n\n  // store values\n  this.params = {};\n  this.path = m[0];\n\n  var keys = this.keys;\n  var params = this.params;\n  var prop;\n  var n = 0;\n  var key;\n  var val;\n\n  for (var i = 1, len = m.length; i < len; ++i) {\n    key = keys[i - 1];\n    prop = key\n      ? key.name\n      : n++;\n    val = decode_param(m[i]);\n\n    if (val !== undefined || !(hasOwnProperty.call(params, prop))) {\n      params[prop] = val;\n    }\n  }\n\n  return true;\n};\n\n/**\n * Decode param value.\n *\n * @param {string} val\n * @return {string}\n * @api private\n */\n\nfunction decode_param(val){\n  if (typeof val !== 'string') {\n    return val;\n  }\n\n  try {\n    return decodeURIComponent(val);\n  } catch (e) {\n    var err = new TypeError(\"Failed to decode param '\" + val + \"'\");\n    err.status = 400;\n    throw err;\n  }\n}\n"]}