{"version":3,"sources":["application.js"],"names":[],"mappings":"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","file":"application-compiled.js","sourcesContent":["/*!\n * express\n * Copyright(c) 2009-2013 TJ Holowaychuk\n * Copyright(c) 2013 Roman Shtylman\n * Copyright(c) 2014-2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n/**\n * Module dependencies.\n * @api private\n */\n\nvar finalhandler = require('finalhandler');\nvar flatten = require('./utils').flatten;\nvar Router = require('./router');\nvar methods = require('methods');\nvar middleware = require('./middleware/init');\nvar query = require('./middleware/query');\nvar debug = require('debug')('express:application');\nvar View = require('./view');\nvar http = require('http');\nvar compileETag = require('./utils').compileETag;\nvar compileQueryParser = require('./utils').compileQueryParser;\nvar compileTrust = require('./utils').compileTrust;\nvar deprecate = require('depd')('express');\nvar merge = require('utils-merge');\nvar resolve = require('path').resolve;\nvar slice = Array.prototype.slice;\n\n/**\n * Application prototype.\n */\n\nvar app = exports = module.exports = {};\n\n/**\n * Variable for trust proxy inheritance back-compat\n * @api private\n */\n\nvar trustProxyDefaultSymbol = '@@symbol:trust_proxy_default';\n\n/**\n * Initialize the server.\n *\n *   - setup default configuration\n *   - setup default middleware\n *   - setup route reflection methods\n *\n * @api private\n */\n\napp.init = function(){\n  this.cache = {};\n  this.settings = {};\n  this.engines = {};\n  this.defaultConfiguration();\n};\n\n/**\n * Initialize application configuration.\n *\n * @api private\n */\n\napp.defaultConfiguration = function(){\n  // default settings\n  this.enable('x-powered-by');\n  this.set('etag', 'weak');\n  var env = process.env.NODE_ENV || 'development';\n  this.set('env', env);\n  this.set('query parser', 'extended');\n  this.set('subdomain offset', 2);\n  this.set('trust proxy', false);\n\n  // trust proxy inherit back-compat\n  Object.defineProperty(this.settings, trustProxyDefaultSymbol, {\n    configurable: true,\n    value: true\n  });\n\n  debug('booting in %s mode', env);\n\n  this.on('mount', function onmount(parent) {\n    // inherit trust proxy\n    if (this.settings[trustProxyDefaultSymbol] === true\n      && typeof parent.settings['trust proxy fn'] === 'function') {\n      delete this.settings['trust proxy'];\n      delete this.settings['trust proxy fn'];\n    }\n\n    // inherit protos\n    this.request.__proto__ = parent.request;\n    this.response.__proto__ = parent.response;\n    this.engines.__proto__ = parent.engines;\n    this.settings.__proto__ = parent.settings;\n  });\n\n  // setup locals\n  this.locals = Object.create(null);\n\n  // top-most app is mounted at /\n  this.mountpath = '/';\n\n  // default locals\n  this.locals.settings = this.settings;\n\n  // default configuration\n  this.set('view', View);\n  this.set('views', resolve('views'));\n  this.set('jsonp callback name', 'callback');\n\n  if (env === 'production') {\n    this.enable('view cache');\n  }\n\n  Object.defineProperty(this, 'router', {\n    get: function() {\n      throw new Error('\\'app.router\\' is deprecated!\\nPlease see the 3.x to 4.x migration guide for details on how to update your app.');\n    }\n  });\n};\n\n/**\n * lazily adds the base router if it has not yet been added.\n *\n * We cannot add the base router in the defaultConfiguration because\n * it reads app settings which might be set after that has run.\n *\n * @api private\n */\napp.lazyrouter = function() {\n  if (!this._router) {\n    this._router = new Router({\n      caseSensitive: this.enabled('case sensitive routing'),\n      strict: this.enabled('strict routing')\n    });\n\n    this._router.use(query(this.get('query parser fn')));\n    this._router.use(middleware.init(this));\n  }\n};\n\n/**\n * Dispatch a req, res pair into the application. Starts pipeline processing.\n *\n * If no _done_ callback is provided, then default error handlers will respond\n * in the event of an error bubbling through the stack.\n *\n * @api private\n */\n\napp.handle = function(req, res, done) {\n  var router = this._router;\n\n  // final handler\n  done = done || finalhandler(req, res, {\n    env: this.get('env'),\n    onerror: logerror.bind(this)\n  });\n\n  // no routes\n  if (!router) {\n    debug('no routes defined on app');\n    done();\n    return;\n  }\n\n  router.handle(req, res, done);\n};\n\n/**\n * Proxy `Router#use()` to add middleware to the app router.\n * See Router#use() documentation for details.\n *\n * If the _fn_ parameter is an express app, then it will be\n * mounted at the _route_ specified.\n *\n * @api public\n */\n\napp.use = function use(fn) {\n  var offset = 0;\n  var path = '/';\n\n  // default path to '/'\n  // disambiguate app.use([fn])\n  if (typeof fn !== 'function') {\n    var arg = fn;\n\n    while (Array.isArray(arg) && arg.length !== 0) {\n      arg = arg[0];\n    }\n\n    // first arg is the path\n    if (typeof arg !== 'function') {\n      offset = 1;\n      path = fn;\n    }\n  }\n\n  var fns = flatten(slice.call(arguments, offset));\n\n  if (fns.length === 0) {\n    throw new TypeError('app.use() requires middleware functions');\n  }\n\n  // setup router\n  this.lazyrouter();\n  var router = this._router;\n\n  fns.forEach(function (fn) {\n    // non-express app\n    if (!fn || !fn.handle || !fn.set) {\n      return router.use(path, fn);\n    }\n\n    debug('.use app under %s', path);\n    fn.mountpath = path;\n    fn.parent = this;\n\n    // restore .app property on req and res\n    router.use(path, function mounted_app(req, res, next) {\n      var orig = req.app;\n      fn.handle(req, res, function (err) {\n        req.__proto__ = orig.request;\n        res.__proto__ = orig.response;\n        next(err);\n      });\n    });\n\n    // mounted an app\n    fn.emit('mount', this);\n  }, this);\n\n  return this;\n};\n\n/**\n * Proxy to the app `Router#route()`\n * Returns a new `Route` instance for the _path_.\n *\n * Routes are isolated middleware stacks for specific paths.\n * See the Route api docs for details.\n *\n * @api public\n */\n\napp.route = function(path){\n  this.lazyrouter();\n  return this._router.route(path);\n};\n\n/**\n * Register the given template engine callback `fn`\n * as `ext`.\n *\n * By default will `require()` the engine based on the\n * file extension. For example if you try to render\n * a \"foo.jade\" file Express will invoke the following internally:\n *\n *     app.engine('jade', require('jade').__express);\n *\n * For engines that do not provide `.__express` out of the box,\n * or if you wish to \"map\" a different extension to the template engine\n * you may use this method. For example mapping the EJS template engine to\n * \".html\" files:\n *\n *     app.engine('html', require('ejs').renderFile);\n *\n * In this case EJS provides a `.renderFile()` method with\n * the same signature that Express expects: `(path, options, callback)`,\n * though note that it aliases this method as `ejs.__express` internally\n * so if you're using \".ejs\" extensions you dont need to do anything.\n *\n * Some template engines do not follow this convention, the\n * [Consolidate.js](https://github.com/tj/consolidate.js)\n * library was created to map all of node's popular template\n * engines to follow this convention, thus allowing them to\n * work seamlessly within Express.\n *\n * @param {String} ext\n * @param {Function} fn\n * @return {app} for chaining\n * @api public\n */\n\napp.engine = function(ext, fn){\n  if ('function' != typeof fn) throw new Error('callback function required');\n  if ('.' != ext[0]) ext = '.' + ext;\n  this.engines[ext] = fn;\n  return this;\n};\n\n/**\n * Proxy to `Router#param()` with one added api feature. The _name_ parameter\n * can be an array of names.\n *\n * See the Router#param() docs for more details.\n *\n * @param {String|Array} name\n * @param {Function} fn\n * @return {app} for chaining\n * @api public\n */\n\napp.param = function(name, fn){\n  this.lazyrouter();\n\n  if (Array.isArray(name)) {\n    name.forEach(function(key) {\n      this.param(key, fn);\n    }, this);\n    return this;\n  }\n\n  this._router.param(name, fn);\n  return this;\n};\n\n/**\n * Assign `setting` to `val`, or return `setting`'s value.\n *\n *    app.set('foo', 'bar');\n *    app.get('foo');\n *    // => \"bar\"\n *\n * Mounted servers inherit their parent server's settings.\n *\n * @param {String} setting\n * @param {*} [val]\n * @return {Server} for chaining\n * @api public\n */\n\napp.set = function(setting, val){\n  if (arguments.length === 1) {\n    // app.get(setting)\n    return this.settings[setting];\n  }\n\n  // set value\n  this.settings[setting] = val;\n\n  // trigger matched settings\n  switch (setting) {\n    case 'etag':\n      debug('compile etag %s', val);\n      this.set('etag fn', compileETag(val));\n      break;\n    case 'query parser':\n      debug('compile query parser %s', val);\n      this.set('query parser fn', compileQueryParser(val));\n      break;\n    case 'trust proxy':\n      debug('compile trust proxy %s', val);\n      this.set('trust proxy fn', compileTrust(val));\n\n      // trust proxy inherit back-compat\n      Object.defineProperty(this.settings, trustProxyDefaultSymbol, {\n        configurable: true,\n        value: false\n      });\n\n      break;\n  }\n\n  return this;\n};\n\n/**\n * Return the app's absolute pathname\n * based on the parent(s) that have\n * mounted it.\n *\n * For example if the application was\n * mounted as \"/admin\", which itself\n * was mounted as \"/blog\" then the\n * return value would be \"/blog/admin\".\n *\n * @return {String}\n * @api private\n */\n\napp.path = function(){\n  return this.parent\n    ? this.parent.path() + this.mountpath\n    : '';\n};\n\n/**\n * Check if `setting` is enabled (truthy).\n *\n *    app.enabled('foo')\n *    // => false\n *\n *    app.enable('foo')\n *    app.enabled('foo')\n *    // => true\n *\n * @param {String} setting\n * @return {Boolean}\n * @api public\n */\n\napp.enabled = function(setting){\n  return !!this.set(setting);\n};\n\n/**\n * Check if `setting` is disabled.\n *\n *    app.disabled('foo')\n *    // => true\n *\n *    app.enable('foo')\n *    app.disabled('foo')\n *    // => false\n *\n * @param {String} setting\n * @return {Boolean}\n * @api public\n */\n\napp.disabled = function(setting){\n  return !this.set(setting);\n};\n\n/**\n * Enable `setting`.\n *\n * @param {String} setting\n * @return {app} for chaining\n * @api public\n */\n\napp.enable = function(setting){\n  return this.set(setting, true);\n};\n\n/**\n * Disable `setting`.\n *\n * @param {String} setting\n * @return {app} for chaining\n * @api public\n */\n\napp.disable = function(setting){\n  return this.set(setting, false);\n};\n\n/**\n * Delegate `.VERB(...)` calls to `router.VERB(...)`.\n */\n\nmethods.forEach(function(method){\n  app[method] = function(path){\n    if ('get' == method && 1 == arguments.length) return this.set(path);\n\n    this.lazyrouter();\n\n    var route = this._router.route(path);\n    route[method].apply(route, slice.call(arguments, 1));\n    return this;\n  };\n});\n\n/**\n * Special-cased \"all\" method, applying the given route `path`,\n * middleware, and callback to _every_ HTTP method.\n *\n * @param {String} path\n * @param {Function} ...\n * @return {app} for chaining\n * @api public\n */\n\napp.all = function(path){\n  this.lazyrouter();\n\n  var route = this._router.route(path);\n  var args = slice.call(arguments, 1);\n  methods.forEach(function(method){\n    route[method].apply(route, args);\n  });\n\n  return this;\n};\n\n// del -> delete alias\n\napp.del = deprecate.function(app.delete, 'app.del: Use app.delete instead');\n\n/**\n * Render the given view `name` name with `options`\n * and a callback accepting an error and the\n * rendered template string.\n *\n * Example:\n *\n *    app.render('email', { name: 'Tobi' }, function(err, html){\n *      // ...\n *    })\n *\n * @param {String} name\n * @param {String|Function} options or fn\n * @param {Function} fn\n * @api public\n */\n\napp.render = function(name, options, fn){\n  var opts = {};\n  var cache = this.cache;\n  var engines = this.engines;\n  var view;\n\n  // support callback function as second arg\n  if ('function' == typeof options) {\n    fn = options, options = {};\n  }\n\n  // merge app.locals\n  merge(opts, this.locals);\n\n  // merge options._locals\n  if (options._locals) {\n    merge(opts, options._locals);\n  }\n\n  // merge options\n  merge(opts, options);\n\n  // set .cache unless explicitly provided\n  opts.cache = null == opts.cache\n    ? this.enabled('view cache')\n    : opts.cache;\n\n  // primed cache\n  if (opts.cache) view = cache[name];\n\n  // view\n  if (!view) {\n    view = new (this.get('view'))(name, {\n      defaultEngine: this.get('view engine'),\n      root: this.get('views'),\n      engines: engines\n    });\n\n    if (!view.path) {\n      var dirs = Array.isArray(view.root) && view.root.length > 1\n        ? 'directories \"' + view.root.slice(0, -1).join('\", \"') + '\" or \"' + view.root[view.root.length - 1] + '\"'\n        : 'directory \"' + view.root + '\"'\n      var err = new Error('Failed to lookup view \"' + name + '\" in views ' + dirs);\n      err.view = view;\n      return fn(err);\n    }\n\n    // prime the cache\n    if (opts.cache) cache[name] = view;\n  }\n\n  // render\n  try {\n    view.render(opts, fn);\n  } catch (err) {\n    fn(err);\n  }\n};\n\n/**\n * Listen for connections.\n *\n * A node `http.Server` is returned, with this\n * application (which is a `Function`) as its\n * callback. If you wish to create both an HTTP\n * and HTTPS server you may do so with the \"http\"\n * and \"https\" modules as shown here:\n *\n *    var http = require('http')\n *      , https = require('https')\n *      , express = require('express')\n *      , app = express();\n *\n *    http.createServer(app).listen(80);\n *    https.createServer({ ... }, app).listen(443);\n *\n * @return {http.Server}\n * @api public\n */\n\napp.listen = function(){\n  var server = http.createServer(this);\n  return server.listen.apply(server, arguments);\n};\n\n/**\n* Log error using console.error.\n*\n* @param {Error} err\n* @api private\n*/\n\nfunction logerror(err){\n  if (this.get('env') !== 'test') console.error(err.stack || err.toString());\n}\n"]}