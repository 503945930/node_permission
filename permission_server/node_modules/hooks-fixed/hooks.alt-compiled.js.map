{"version":3,"sources":["hooks.alt.js"],"names":[],"mappings":"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","file":"hooks.alt-compiled.js","sourcesContent":["/**\n * Hooks are useful if we want to add a method that automatically has `pre` and `post` hooks.\n * For example, it would be convenient to have `pre` and `post` hooks for `save`.\n * _.extend(Model, mixins.hooks);\n * Model.hook('save', function () {\n *  console.log('saving');\n * });\n * Model.pre('save', function (next, done) {\n *  console.log('about to save');\n *  next();\n * });\n * Model.post('save', function (next, done) {\n *  console.log('saved');\n *  next();\n * });\n *\n * var m = new Model();\n * m.save();\n * // about to save\n * // saving\n * // saved \n */\n\n// TODO Add in pre and post skipping options\nmodule.exports = {\n  /**\n   *  Declares a new hook to which you can add pres and posts\n   *  @param {String} name of the function\n   *  @param {Function} the method\n   *  @param {Function} the error handler callback\n   */\n  hook: function (name, fn, err) {\n    if (arguments.length === 1 && typeof name === 'object') {\n      for (var k in name) { // `name` is a hash of hookName->hookFn\n        this.hook(k, name[k]);\n      }\n      return;\n    }\n\n    if (!err) err = fn;\n\n    var proto = this.prototype || this\n      , pres = proto._pres = proto._pres || {}\n      , posts = proto._posts = proto._posts || {};\n    pres[name] = pres[name] || [];\n    posts[name] = posts[name] || [];\n\n    function noop () {}\n\n    proto[name] = function () {\n      var self = this\n        , pres = this._pres[name]\n        , posts = this._posts[name]\n        , numAsyncPres = 0\n        , hookArgs = [].slice.call(arguments)\n        , preChain = pres.map( function (pre, i) {\n            var wrapper = function () {\n              if (arguments[0] instanceof Error)\n                return err(arguments[0]);\n              if (numAsyncPres) {\n                // arguments[1] === asyncComplete\n                if (arguments.length)\n                  hookArgs = [].slice.call(arguments, 2);\n                pre.apply(self, \n                  [ preChain[i+1] || allPresInvoked, \n                    asyncComplete\n                  ].concat(hookArgs)\n                );\n              } else {\n                if (arguments.length)\n                  hookArgs = [].slice.call(arguments);\n                pre.apply(self,\n                  [ preChain[i+1] || allPresDone ].concat(hookArgs));\n              }\n            }; // end wrapper = function () {...\n            if (wrapper.isAsync = pre.isAsync)\n              numAsyncPres++;\n            return wrapper;\n          }); // end posts.map(...)\n      function allPresInvoked () {\n        if (arguments[0] instanceof Error)\n          err(arguments[0]);\n      }\n\n      function allPresDone () {\n        if (arguments[0] instanceof Error)\n          return err(arguments[0]);\n        if (arguments.length)\n          hookArgs = [].slice.call(arguments);\n        fn.apply(self, hookArgs);\n        var postChain = posts.map( function (post, i) {\n          var wrapper = function () {\n            if (arguments[0] instanceof Error)\n              return err(arguments[0]);\n            if (arguments.length)\n              hookArgs = [].slice.call(arguments);\n            post.apply(self,\n              [ postChain[i+1] || noop].concat(hookArgs));\n          }; // end wrapper = function () {...\n          return wrapper;\n        }); // end posts.map(...)\n        if (postChain.length) postChain[0]();\n      }\n\n      if (numAsyncPres) {\n        complete = numAsyncPres;\n        function asyncComplete () {\n          if (arguments[0] instanceof Error)\n            return err(arguments[0]);\n          --complete || allPresDone.call(this);\n        }\n      }\n      (preChain[0] || allPresDone)();\n    };\n\n    return this;\n  },\n\n  pre: function (name, fn, isAsync) {\n    var proto = this.prototype\n      , pres = proto._pres = proto._pres || {};\n    if (fn.isAsync = isAsync) {\n      this.prototype[name].numAsyncPres++;\n    }\n    (pres[name] = pres[name] || []).push(fn);\n    return this;\n  },\n  post: function (name, fn, isAsync) {\n    var proto = this.prototype\n      , posts = proto._posts = proto._posts || {};\n    (posts[name] = posts[name] || []).push(fn);\n    return this;\n  }\n};\n"]}