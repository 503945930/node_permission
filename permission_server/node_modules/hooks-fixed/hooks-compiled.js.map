{"version":3,"sources":["hooks.js"],"names":[],"mappings":"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","file":"hooks-compiled.js","sourcesContent":["// TODO Add in pre and post skipping options\nmodule.exports = {\n  /**\n   *  Declares a new hook to which you can add pres and posts\n   *  @param {String} name of the function\n   *  @param {Function} the method\n   *  @param {Function} the error handler callback\n   */\n  hook: function (name, fn, errorCb) {\n    if (arguments.length === 1 && typeof name === 'object') {\n      for (var k in name) { // `name` is a hash of hookName->hookFn\n        this.hook(k, name[k]);\n      }\n      return;\n    }\n\n    var proto = this.prototype || this\n      , pres = proto._pres = proto._pres || {}\n      , posts = proto._posts = proto._posts || {};\n    pres[name] = pres[name] || [];\n    posts[name] = posts[name] || [];\n\n    proto[name] = function () {\n      var self = this\n        , hookArgs // arguments eventually passed to the hook - are mutable\n        , lastArg = arguments[arguments.length-1]\n        , pres = this._pres[name]\n        , posts = this._posts[name]\n        , _total = pres.length\n        , _current = -1\n        , _asyncsLeft = proto[name].numAsyncPres\n        , _asyncsDone = function(err) {\n            if (err) {\n              return handleError(err);\n            }\n            --_asyncsLeft || _done.apply(self, hookArgs);\n          }\n        , handleError = function(err) {\n            if ('function' == typeof lastArg)\n              return lastArg(err);\n            if (errorCb) return errorCb.call(self, err);\n            throw err;\n          }\n        , _next = function () {\n            if (arguments[0] instanceof Error) {\n              return handleError(arguments[0]);\n            }\n            var _args = Array.prototype.slice.call(arguments)\n              , currPre\n              , preArgs;\n            if (_args.length && !(arguments[0] == null && typeof lastArg === 'function'))\n              hookArgs = _args;\n            if (++_current < _total) {\n              currPre = pres[_current]\n              if (currPre.isAsync && currPre.length < 2)\n                throw new Error(\"Your pre must have next and done arguments -- e.g., function (next, done, ...)\");\n              if (currPre.length < 1)\n                throw new Error(\"Your pre must have a next argument -- e.g., function (next, ...)\");\n              preArgs = (currPre.isAsync\n                          ? [once(_next), once(_asyncsDone)]\n                          : [once(_next)]).concat(hookArgs);\n              return currPre.apply(self, preArgs);\n            } else if (!_asyncsLeft) {\n              return _done.apply(self, hookArgs);\n            }\n          }\n        , _done = function () {\n            var args_ = Array.prototype.slice.call(arguments)\n              , ret, total_, current_, next_, done_, postArgs;\n\n            if (_current === _total) {\n              \n              next_ = function () {\n                if (arguments[0] instanceof Error) {\n                  return handleError(arguments[0]);\n                }\n                var args_ = Array.prototype.slice.call(arguments, 1)\n                  , currPost\n                  , postArgs;\n                if (args_.length) hookArgs = args_;\n                if (++current_ < total_) {\n                  currPost = posts[current_]\n                  if (currPost.length < 1)\n                    throw new Error(\"Your post must have a next argument -- e.g., function (next, ...)\");\n                  postArgs = [once(next_)].concat(hookArgs);\n                  return currPost.apply(self, postArgs);\n                } else if (typeof lastArg === 'function'){\n                  // All post handlers are done, call original callback function\n                  return lastArg.apply(self, arguments);\n                }\n              };\n\n              // We are assuming that if the last argument provided to the wrapped function is a function, it was expecting\n              // a callback.  We trap that callback and wait to call it until all post handlers have finished.\n              if(typeof lastArg === 'function'){\n                args_[args_.length - 1] = once(next_);\n              }\n\n              total_ = posts.length;\n              current_ = -1;\n              ret = fn.apply(self, args_); // Execute wrapped function, post handlers come afterward\n\n              if (total_ && typeof lastArg !== 'function') return next_();  // no callback provided, execute next_() manually\n              return ret;\n            }\n          };\n\n      return _next.apply(this, arguments);\n    };\n    \n    proto[name].numAsyncPres = 0;\n\n    return this;\n  },\n\n  pre: function (name, isAsync, fn, errorCb) {\n    if ('boolean' !== typeof arguments[1]) {\n      errorCb = fn;\n      fn = isAsync;\n      isAsync = false;\n    }\n    var proto = this.prototype || this\n      , pres = proto._pres = proto._pres || {};\n\n    this._lazySetupHooks(proto, name, errorCb);\n\n    if (fn.isAsync = isAsync) {\n      proto[name].numAsyncPres++;\n    }\n\n    (pres[name] = pres[name] || []).push(fn);\n    return this;\n  },\n  post: function (name, isAsync, fn) {\n    if (arguments.length === 2) {\n      fn = isAsync;\n      isAsync = false;\n    }\n    var proto = this.prototype || this\n      , posts = proto._posts = proto._posts || {};\n    \n    this._lazySetupHooks(proto, name);\n    (posts[name] = posts[name] || []).push(fn);\n    return this;\n  },\n  removePre: function (name, fnToRemove) {\n    var proto = this.prototype || this\n      , pres = proto._pres || (proto._pres || {});\n    if (!pres[name]) return this;\n    if (arguments.length === 1) {\n      // Remove all pre callbacks for hook `name`\n      pres[name].length = 0;\n    } else {\n      pres[name] = pres[name].filter( function (currFn) {\n        return currFn !== fnToRemove;\n      });\n    }\n    return this;\n  },\n  _lazySetupHooks: function (proto, methodName, errorCb) {\n    if ('undefined' === typeof proto[methodName].numAsyncPres) {\n      this.hook(methodName, proto[methodName], errorCb);\n    }\n  }\n};\n\nfunction once (fn, scope) {\n  return function fnWrapper () {\n    if (fnWrapper.hookCalled) return;\n    fnWrapper.hookCalled = true;\n    return fn.apply(scope, arguments);\n  };\n}\n"]}