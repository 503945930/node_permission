{"version":3,"sources":["index.js"],"names":[],"mappings":"AAAA,YAAY,CAAC;;AAEb,SAAS,MAAM,GAAG;AAChB,MAAI,CAAC,KAAK,GAAG,EAAE,CAAC;AAChB,MAAI,CAAC,MAAM,GAAG,EAAE,CAAC;CAClB;;AAED,MAAM,CAAC,SAAS,CAAC,OAAO,GAAG,UAAS,IAAI,EAAE,OAAO,EAAE,QAAQ,EAAE;AAC3D,MAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC;AAClC,MAAI,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC;AAC1B,MAAI,YAAY,GAAG,IAAI,CAAC,QAAQ,IAAI,CAAC,CAAC;AACtC,MAAI,UAAU,GAAG,CAAC,CAAC;AACnB,MAAI,aAAa,GAAG,YAAY,CAAC;AACjC,MAAI,IAAI,GAAG,KAAK,CAAC;;AAEjB,MAAI,CAAC,OAAO,EAAE;AACZ,WAAO,OAAO,CAAC,QAAQ,CAAC,YAAW;AACjC,cAAQ,CAAC,IAAI,CAAC,CAAC;KAChB,CAAC,CAAC;GACJ;;AAED,MAAI,IAAI,GAAG,SAAP,IAAI,GAAc;AACpB,QAAI,UAAU,IAAI,OAAO,EAAE;AACzB,aAAO;KACR;AACD,QAAI,GAAG,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC;;AAE3B,QAAI,GAAG,CAAC,OAAO,EAAE;AACf,SAAG,CAAC,EAAE,CAAC,IAAI,CACT,OAAO,EACP,UAAS,KAAK,EAAE;AACd,YAAI,KAAK,EAAE;AACT,cAAI,IAAI,EAAE;AACR,mBAAO;WACR;AACD,cAAI,GAAG,IAAI,CAAC;AACZ,iBAAO,QAAQ,CAAC,KAAK,CAAC,CAAC;SACxB;;AAED,UAAE,UAAU,CAAC;AACb,YAAI,CAAC,KAAK,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;OAChC,EACD,UAAS,KAAK,EAAE;AACd,YAAI,KAAK,EAAE;AACT,cAAI,IAAI,EAAE;AACR,mBAAO;WACR;AACD,cAAI,GAAG,IAAI,CAAC;AACZ,iBAAO,QAAQ,CAAC,KAAK,CAAC,CAAC;SACxB;;AAED,YAAI,EAAE,YAAY,KAAK,CAAC,EAAE;AACxB,iBAAO,QAAQ,CAAC,IAAI,CAAC,CAAC;SACvB;OACF,CAAC,CAAC;KACN,MAAM,IAAI,GAAG,CAAC,EAAE,CAAC,MAAM,GAAG,CAAC,EAAE;AAC5B,UAAI,IAAI,GAAG,CAAC,UAAS,KAAK,EAAE;AAC1B,YAAI,KAAK,EAAE;AACT,cAAI,IAAI,EAAE;AACR,mBAAO;WACR;AACD,cAAI,GAAG,IAAI,CAAC;AACZ,iBAAO,QAAQ,CAAC,KAAK,CAAC,CAAC;SACxB;;AAED,YAAI,EAAE,UAAU,IAAI,OAAO,EAAE;AAC3B,cAAI,aAAa,GAAG,CAAC,EAAE;;AAErB,mBAAO;WACR,MAAM;AACL,mBAAO,QAAQ,CAAC,IAAI,CAAC,CAAC;WACvB;SACF;;AAED,YAAI,CAAC,KAAK,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;OAChC,CAAC,CAAC;AACH,UAAI,SAAS,CAAC,MAAM,IAAI,CAAC,EAAE;AACzB,aAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE;AACzC,cAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;SACzB;OACF;AACD,SAAG,CAAC,EAAE,CAAC,KAAK,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;KAC7B,MAAM;AACL,SAAG,CAAC,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AACrB,UAAI,EAAE,UAAU,IAAI,OAAO,EAAE;AAC3B,YAAI,aAAa,GAAG,CAAC,EAAE;;AAErB,iBAAO;SACR,MAAM;AACL,iBAAO,OAAO,CAAC,QAAQ,CAAC,YAAW;AACjC,oBAAQ,CAAC,IAAI,CAAC,CAAC;WAChB,CAAC,CAAC;SACJ;OACF;AACD,UAAI,EAAE,CAAC;KACR;GACF,CAAC;;AAEF,MAAI,EAAE,CAAC;CACR,CAAC;;AAEF,MAAM,CAAC,SAAS,CAAC,QAAQ,GAAG,UAAS,IAAI,EAAE,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAE;AAClE,MAAI,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC;AACpC,MAAI,QAAQ,GAAG,KAAK,CAAC,MAAM,CAAC;AAC5B,MAAI,WAAW,GAAG,CAAC,CAAC;;AAEpB,MAAI,CAAC,QAAQ,EAAE;AACb,WAAO,OAAO,CAAC,QAAQ,CAAC,YAAW;AACjC,cAAQ,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;KAC3C,CAAC,CAAC;GACJ;;AAED,MAAI,IAAI,GAAG,SAAP,IAAI,GAAc;AACpB,QAAI,IAAI,GAAG,KAAK,CAAC,WAAW,CAAC,CAAC;;AAE9B,QAAI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,EAAE;AAC7B,UAAI,CAAC,KAAK,CAAC,OAAO,EAAE,IAAI,CAAC,MAAM,CAAC,UAAS,KAAK,EAAE;AAC9C,YAAI,KAAK,EAAE;AACT,iBAAO,QAAQ,CAAC,KAAK,CAAC,CAAC;SACxB;;AAED,YAAI,EAAE,WAAW,IAAI,QAAQ,EAAE;AAC7B,iBAAO,QAAQ,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;SAClD;;AAED,YAAI,EAAE,CAAC;OACR,CAAC,CAAC,CAAC;KACL,MAAM;AACL,UAAI,CAAC,KAAK,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;;AAE1B,UAAI,EAAE,WAAW,IAAI,QAAQ,EAAE;AAC7B,eAAO,QAAQ,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;OAClD;;AAED,UAAI,EAAE,CAAC;KACR;GACF,CAAC;;AAEF,MAAI,EAAE,CAAC;CACR,CAAC;;AAEF,MAAM,CAAC,SAAS,CAAC,IAAI,GAAG,UAAS,IAAI,EAAE,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,aAAa,EAAE;AACvE,MAAI,OAAO,GAAI,IAAI,CAAC,MAAM,GAAG,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,GAAG,IAAI,AAAC,CAAC;AAC/D,MAAI,KAAK,GAAG,IAAI,CAAC;;AAEjB,MAAI,CAAC,OAAO,CAAC,IAAI,EAAE,OAAO,EAAE,UAAS,KAAK,EAAE;AAC1C,QAAI,KAAK,EAAE;AACT,UAAI,OAAO,OAAO,KAAK,UAAU,EAAE;AACjC,eAAO,OAAO,CAAC,KAAK,CAAC,CAAC;OACvB;AACD,aAAO;KACR;;AAED,QAAI,GAAG,GAAI,OAAO,OAAO,KAAK,UAAU,GAAG,IAAI,CAAC,MAAM,GAAG,CAAC,GAAG,IAAI,CAAC,MAAM,AAAC,CAAC;;AAE1E,MAAE,CAAC,KAAK,CAAC,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,MAAM,CAAC,YAAW;AACrD,UAAI,SAAS,CAAC,CAAC,CAAC,EAAE;;AAEhB,eAAO,OAAO,OAAO,KAAK,UAAU,GAClC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,GACrB,SAAS,CAAC;OACb;;AAED,UAAI,aAAa,IAAI,OAAO,OAAO,KAAK,UAAU,EAAE;AAClD,eAAO,CAAC,KAAK,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;OACnC;;AAED,UAAI,gBAAgB,GAAG,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;AAChE,WAAK,CAAC,QAAQ,CAAC,IAAI,EAAE,OAAO,EAAE,gBAAgB,EAAE,YAAW;AACzD,YAAI,SAAS,CAAC,CAAC,CAAC,EAAE;AAChB,iBAAO,OAAO,OAAO,KAAK,UAAU,GAClC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,GACrB,SAAS,CAAC;SACb;;AAED,eAAO,OAAO,OAAO,KAAK,UAAU,IAAI,CAAC,aAAa,GACpD,OAAO,CAAC,KAAK,CAAC,OAAO,EAAE,SAAS,CAAC,GACjC,SAAS,CAAC;OACb,CAAC,CAAC;KACJ,CAAC,CAAC,CAAC;GACL,CAAC,CAAC;CACJ,CAAC;;AAEF,MAAM,CAAC,SAAS,CAAC,aAAa,GAAG,UAAS,IAAI,EAAE,EAAE,EAAE,OAAO,EAAE;AAC3D,MAAI,KAAK,GAAG,IAAI,CAAC;AACjB,SAAO,YAAW;AAChB,QAAI,IAAI,GAAG,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;AACjD,SAAK,CAAC,IAAI,CAAC,IAAI,EAAE,EAAE,EAAE,OAAO,EAAE,IAAI,CAAC,CAAC;GACrC,CAAC;CACH,CAAC;;AAEF,MAAM,CAAC,SAAS,CAAC,GAAG,GAAG,UAAS,IAAI,EAAE,OAAO,EAAE,EAAE,EAAE,KAAK,EAAE;AACxD,MAAI,OAAO,SAAS,CAAC,CAAC,CAAC,KAAK,SAAS,EAAE;AACrC,SAAK,GAAG,EAAE,CAAC;AACX,MAAE,GAAG,OAAO,CAAC;AACb,WAAO,GAAG,KAAK,CAAC;GACjB;;AAED,MAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC;AAC1C,MAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;;AAE5B,MAAI,OAAO,EAAE;AACX,QAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,IAAI,CAAC,CAAC;AACnC,MAAE,IAAI,CAAC,QAAQ,CAAC;GACjB;;AAED,MAAI,CAAC,IAAI,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,OAAO,EAAE,OAAO,EAAE,CAAC,CAAC;;AAExC,SAAO,IAAI,CAAC;CACb,CAAC;;AAEF,MAAM,CAAC,SAAS,CAAC,IAAI,GAAG,UAAS,IAAI,EAAE,EAAE,EAAE;AACzC,GAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,EAAE,CAAA,CAAE,IAAI,CAAC,EAAE,CAAC,CAAC;AACvD,SAAO,IAAI,CAAC;CACb,CAAC;;AAEF,MAAM,CAAC,SAAS,CAAC,KAAK,GAAG,YAAW;AAClC,MAAI,CAAC,GAAG,IAAI,MAAM,EAAE,CAAC;AACrB,OAAK,IAAI,GAAG,IAAI,IAAI,CAAC,KAAK,EAAE;AAC1B,KAAC,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,KAAK,EAAE,CAAC;GACxC;AACD,OAAK,IAAI,GAAG,IAAI,IAAI,CAAC,MAAM,EAAE;AAC3B,KAAC,CAAC,MAAM,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,KAAK,EAAE,CAAC;GAC1C;;AAED,SAAO,CAAC,CAAC;CACV,CAAC;;AAEF,MAAM,CAAC,OAAO,GAAG,MAAM,CAAC","file":"index-compiled.js","sourcesContent":["'use strict';\n\nfunction Kareem() {\n  this._pres = {};\n  this._posts = {};\n}\n\nKareem.prototype.execPre = function(name, context, callback) {\n  var pres = this._pres[name] || [];\n  var numPres = pres.length;\n  var numAsyncPres = pres.numAsync || 0;\n  var currentPre = 0;\n  var asyncPresLeft = numAsyncPres;\n  var done = false;\n\n  if (!numPres) {\n    return process.nextTick(function() {\n      callback(null);\n    });\n  }\n\n  var next = function() {\n    if (currentPre >= numPres) {\n      return;\n    }\n    var pre = pres[currentPre];\n\n    if (pre.isAsync) {\n      pre.fn.call(\n        context,\n        function(error) {\n          if (error) {\n            if (done) {\n              return;\n            }\n            done = true;\n            return callback(error);\n          }\n\n          ++currentPre;\n          next.apply(context, arguments);\n        },\n        function(error) {\n          if (error) {\n            if (done) {\n              return;\n            }\n            done = true;\n            return callback(error);\n          }\n\n          if (--numAsyncPres === 0) {\n            return callback(null);\n          }\n        });\n    } else if (pre.fn.length > 0) {\n      var args = [function(error) {\n        if (error) {\n          if (done) {\n            return;\n          }\n          done = true;\n          return callback(error);\n        }\n\n        if (++currentPre >= numPres) {\n          if (asyncPresLeft > 0) {\n            // Leave parallel hooks to run\n            return;\n          } else {\n            return callback(null);\n          }\n        }\n\n        next.apply(context, arguments);\n      }];\n      if (arguments.length >= 2) {\n        for (var i = 1; i < arguments.length; ++i) {\n          args.push(arguments[i]);\n        }\n      }\n      pre.fn.apply(context, args);\n    } else {\n      pre.fn.call(context);\n      if (++currentPre >= numPres) {\n        if (asyncPresLeft > 0) {\n          // Leave parallel hooks to run\n          return;\n        } else {\n          return process.nextTick(function() {\n            callback(null);\n          });\n        }\n      }\n      next();\n    }\n  };\n\n  next();\n};\n\nKareem.prototype.execPost = function(name, context, args, callback) {\n  var posts = this._posts[name] || [];\n  var numPosts = posts.length;\n  var currentPost = 0;\n\n  if (!numPosts) {\n    return process.nextTick(function() {\n      callback.apply(null, [null].concat(args));\n    });\n  }\n\n  var next = function() {\n    var post = posts[currentPost];\n\n    if (post.length > args.length) {\n      post.apply(context, args.concat(function(error) {\n        if (error) {\n          return callback(error);\n        }\n\n        if (++currentPost >= numPosts) {\n          return callback.apply(null, [null].concat(args));\n        }\n\n        next();\n      }));\n    } else {\n      post.apply(context, args);\n\n      if (++currentPost >= numPosts) {\n        return callback.apply(null, [null].concat(args));\n      }\n\n      next();\n    }\n  };\n\n  next();\n};\n\nKareem.prototype.wrap = function(name, fn, context, args, useLegacyPost) {\n  var lastArg = (args.length > 0 ? args[args.length - 1] : null);\n  var _this = this;\n\n  this.execPre(name, context, function(error) {\n    if (error) {\n      if (typeof lastArg === 'function') {\n        return lastArg(error);\n      }\n      return;\n    }\n\n    var end = (typeof lastArg === 'function' ? args.length - 1 : args.length);\n\n    fn.apply(context, args.slice(0, end).concat(function() {\n      if (arguments[0]) {\n        // Assume error\n        return typeof lastArg === 'function' ?\n          lastArg(arguments[0]) :\n          undefined;\n      }\n\n      if (useLegacyPost && typeof lastArg === 'function') {\n        lastArg.apply(context, arguments);\n      }\n\n      var argsWithoutError = Array.prototype.slice.call(arguments, 1);\n      _this.execPost(name, context, argsWithoutError, function() {\n        if (arguments[0]) {\n          return typeof lastArg === 'function' ?\n            lastArg(arguments[0]) :\n            undefined;\n        }\n\n        return typeof lastArg === 'function' && !useLegacyPost ?\n          lastArg.apply(context, arguments) :\n          undefined;\n      });\n    }));\n  });\n};\n\nKareem.prototype.createWrapper = function(name, fn, context) {\n  var _this = this;\n  return function() {\n    var args = Array.prototype.slice.call(arguments);\n    _this.wrap(name, fn, context, args);\n  };\n};\n\nKareem.prototype.pre = function(name, isAsync, fn, error) {\n  if (typeof arguments[1] !== 'boolean') {\n    error = fn;\n    fn = isAsync;\n    isAsync = false;\n  }\n\n  this._pres[name] = this._pres[name] || [];\n  var pres = this._pres[name];\n\n  if (isAsync) {\n    pres.numAsync = pres.numAsync || 0;\n    ++pres.numAsync;\n  }\n\n  pres.push({ fn: fn, isAsync: isAsync });\n\n  return this;\n};\n\nKareem.prototype.post = function(name, fn) {\n  (this._posts[name] = this._posts[name] || []).push(fn);\n  return this;\n};\n\nKareem.prototype.clone = function() {\n  var n = new Kareem();\n  for (var key in this._pres) {\n    n._pres[key] = this._pres[key].slice();\n  }\n  for (var key in this._posts) {\n    n._posts[key] = this._posts[key].slice();\n  }\n\n  return n;\n};\n\nmodule.exports = Kareem;\n"]}