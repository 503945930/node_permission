{"version":3,"sources":["wrap.test.js"],"names":[],"mappings":"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","file":"wrap.test-compiled.js","sourcesContent":["var assert = require('assert');\nvar Kareem = require('../');\n\ndescribe('wrap()', function() {\n  var hooks;\n\n  beforeEach(function() {\n    hooks = new Kareem();\n  });\n\n  it('handles pre errors', function(done) {\n    hooks.pre('cook', function(done) {\n      done('error!');\n    });\n\n    hooks.post('cook', function(obj) {\n      obj.tofu = 'no';\n    });\n\n    var obj = { bacon: 0, eggs: 0 };\n\n    var args = [obj];\n    args.push(function(error, result) {\n      assert.equal('error!', error);\n      assert.ok(!result);\n      assert.equal(undefined, obj.tofu);\n      done();\n    });\n\n    hooks.wrap(\n      'cook',\n      function(o, callback) {\n        // Should never get called\n        assert.ok(false);\n        callback(null, o);\n      },\n      obj,\n      args);\n  });\n\n  it('handles pre errors when no callback defined', function(done) {\n    hooks.pre('cook', function(done) {\n      done('error!');\n    });\n\n    hooks.post('cook', function(obj) {\n      obj.tofu = 'no';\n    });\n\n    var obj = { bacon: 0, eggs: 0 };\n\n    var args = [obj];\n\n    hooks.wrap(\n      'cook',\n      function(o, callback) {\n        // Should never get called\n        assert.ok(false);\n        callback(null, o);\n      },\n      obj,\n      args);\n\n    setTimeout(\n      function() {\n        done();\n      },\n      25);\n  });\n\n  it('handles errors in wrapped function', function(done) {\n    hooks.pre('cook', function(done) {\n      done();\n    });\n\n    hooks.post('cook', function(obj) {\n      obj.tofu = 'no';\n    });\n\n    var obj = { bacon: 0, eggs: 0 };\n\n    var args = [obj];\n    args.push(function(error, result) {\n      assert.equal('error!', error);\n      assert.ok(!result);\n      assert.equal(undefined, obj.tofu);\n      done();\n    });\n\n    hooks.wrap(\n      'cook',\n      function(o, callback) {\n        callback('error!');\n      },\n      obj,\n      args);\n  });\n\n  it('handles errors in post', function(done) {\n    hooks.pre('cook', function(done) {\n      done();\n    });\n\n    hooks.post('cook', function(obj, callback) {\n      obj.tofu = 'no';\n      callback('error!');\n    });\n\n    var obj = { bacon: 0, eggs: 0 };\n\n    var args = [obj];\n    args.push(function(error, result) {\n      assert.equal('error!', error);\n      assert.ok(!result);\n      assert.equal('no', obj.tofu);\n      done();\n    });\n\n    hooks.wrap(\n      'cook',\n      function(o, callback) {\n        callback(null, o);\n      },\n      obj,\n      args);\n  });\n\n  it('works with no args', function(done) {\n    hooks.pre('cook', function(done) {\n      done();\n    });\n\n    hooks.post('cook', function(callback) {\n      obj.tofu = 'no';\n      callback();\n    });\n\n    var obj = { bacon: 0, eggs: 0 };\n\n    var args = [];\n\n    hooks.wrap(\n      'cook',\n      function(callback) {\n        callback(null);\n      },\n      obj,\n      args);\n\n    setTimeout(\n      function() {\n        assert.equal('no', obj.tofu);\n        done();\n      },\n      25);\n  });\n\n  it('handles pre errors with no args', function(done) {\n    hooks.pre('cook', function(done) {\n      done('error!');\n    });\n\n    hooks.post('cook', function(callback) {\n      obj.tofu = 'no';\n      callback();\n    });\n\n    var obj = { bacon: 0, eggs: 0 };\n\n    var args = [];\n\n    hooks.wrap(\n      'cook',\n      function(callback) {\n        callback(null);\n      },\n      obj,\n      args);\n\n    setTimeout(\n      function() {\n        assert.equal(undefined, obj.tofu);\n        done();\n      },\n      25);\n  });\n\n  it('handles wrapped function errors with no args', function(done) {\n    hooks.pre('cook', function(done) {\n      obj.waffles = false;\n      done();\n    });\n\n    hooks.post('cook', function(callback) {\n      obj.tofu = 'no';\n      callback();\n    });\n\n    var obj = { bacon: 0, eggs: 0 };\n\n    var args = [];\n\n    hooks.wrap(\n      'cook',\n      function(callback) {\n        callback('error!');\n      },\n      obj,\n      args);\n\n    setTimeout(\n      function() {\n        assert.equal(false, obj.waffles);\n        assert.equal(undefined, obj.tofu);\n        done();\n      },\n      25);\n  });\n\n  it('handles post errors with no args', function(done) {\n    hooks.pre('cook', function(done) {\n      obj.waffles = false;\n      done();\n    });\n\n    hooks.post('cook', function(callback) {\n      obj.tofu = 'no';\n      callback('error!');\n    });\n\n    var obj = { bacon: 0, eggs: 0 };\n\n    var args = [];\n\n    hooks.wrap(\n      'cook',\n      function(callback) {\n        callback();\n      },\n      obj,\n      args);\n\n    setTimeout(\n      function() {\n        assert.equal(false, obj.waffles);\n        assert.equal('no', obj.tofu);\n        done();\n      },\n      25);\n  });\n\n  it('can use legacy post behavior', function(done) {\n    var called = 0;\n    hooks.post('cook', function(callback) {\n      ++called;\n      callback();\n    });\n\n    var args = [function(error) {\n      assert.equal(called, 0);\n\n      setTimeout(function() {\n        assert.equal(called, 1);\n        done();\n      }, 0);\n    }];\n\n    hooks.wrap(\n      'cook',\n      function(callback) {\n        callback();\n      },\n      null,\n      args,\n      true);\n  });\n});"]}