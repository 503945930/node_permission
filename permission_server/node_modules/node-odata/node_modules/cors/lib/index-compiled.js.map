{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["/*jslint indent: 2*/\n/*global require: true, module: true*/\n\n(function () {\n\n  'use strict';\n\n  var defaults = {\n    origin: '*',\n    methods: 'GET,HEAD,PUT,PATCH,POST,DELETE'\n  };\n\n  function configureOrigin(options, req) {\n    var origin = options.origin;\n    if (origin === true) {\n      origin = req.headers.origin;\n    } else if (!origin) {\n      origin = '*';\n    }\n    return {\n      key: 'Access-Control-Allow-Origin',\n      value: origin\n    };\n  }\n\n  function configureMethods(options) {\n    var methods = options.methods || defaults.methods;\n    if (methods.join) {\n      methods = options.methods.join(','); // .methods is an array, so turn it into a string\n    }\n    return {\n      key: 'Access-Control-Allow-Methods',\n      value: methods\n    };\n  }\n\n  function configureCredentials(options) {\n    if (options.credentials === true) {\n      return {\n        key: 'Access-Control-Allow-Credentials',\n        value: 'true'\n      };\n    }\n    return null;\n  }\n\n  function configureAllowedHeaders(options, req) {\n    var headers = options.allowedHeaders || options.headers;\n    if (!headers) {\n      headers = req.headers['access-control-request-headers']; // .headers wasn't specified, so reflect the request headers\n    } else if (headers.join) {\n      headers = headers.join(','); // .headers is an array, so turn it into a string\n    }\n    if (headers && headers.length) {\n      return {\n        key: 'Access-Control-Allow-Headers',\n        value: headers\n      };\n    }\n    return null;\n  }\n\n  function configureExposedHeaders(options, req) {\n    var headers = options.exposedHeaders;\n    if (!headers) {\n      return null;\n    } else if (headers.join) {\n      headers = headers.join(','); // .headers is an array, so turn it into a string\n    }\n    if (headers && headers.length) {\n      return {\n        key: 'Access-Control-Expose-Headers',\n        value: headers\n      };\n    }\n    return null;\n  }\n\n  function configureMaxAge(options) {\n    var maxAge = options.maxAge && options.maxAge.toString();\n    if (maxAge && maxAge.length) {\n      return {\n        key: 'Access-Control-Max-Age',\n        value: maxAge\n      };\n    }\n    return null;\n  }\n\n  function cors(options, req, res, next) {\n    var headers = [],\n      method = req.method && req.method.toUpperCase && req.method.toUpperCase(),\n      applyHeaders = function (headers, res) {\n        headers.forEach(function (header) {\n          if (header && header.value) {\n            if (res.set) {\n              res.set(header.key, header.value);\n            } else {\n              // for Express <4\n              res.setHeader(header.key, header.value);\n            }\n          }\n        });\n      };\n\n    if (method === 'OPTIONS') {\n      // preflight\n      headers.push(configureOrigin(options, req));\n      headers.push(configureCredentials(options, req));\n      headers.push(configureMethods(options, req));\n      headers.push(configureAllowedHeaders(options, req));\n      headers.push(configureMaxAge(options, req));\n      applyHeaders(headers, res);\n      res.statusCode = 204;\n      res.end();\n    } else {\n      // actual response\n      headers.push(configureOrigin(options, req));\n      headers.push(configureCredentials(options, req));\n      headers.push(configureExposedHeaders(options, req));\n      applyHeaders(headers, res);\n      next();\n    }\n  }\n\n  function middlewareWrapper(o) {\n    // if no options were passed in, use the defaults\n    if (!o) {\n      o = {};\n    }\n    if (o.origin === undefined) {\n      o.origin = defaults.origin;\n    }\n    if (o.methods === undefined) {\n      o.methods = defaults.methods;\n    }\n\n    // if options are static (either via defaults or custom options passed in), wrap in a function\n    var optionsCallback = null;\n    if (typeof o === 'function') {\n      optionsCallback = o;\n    } else {\n      /*jslint unparam: true*/ // `req` is part of the signature, but isn't used for this stub\n      optionsCallback = function (req, cb) {\n        cb(null, o);\n      };\n      /*jslint unparam: false*/\n    }\n\n    return function (req, res, next) {\n      optionsCallback(req, function (err, options) {\n        if (err) {\n          next(err);\n        } else {\n          var originCallback = null;\n          if (options.origin && typeof options.origin === 'function') {\n            originCallback = options.origin;\n          } else if (options.origin) {\n            /*jslint unparam: true*/ // `origin` is part of the signature, but isn't used for this stub\n            originCallback = function (origin, cb) {\n              cb(null, options.origin);\n            };\n            /*jslint unparam: false*/\n          }\n\n          if (originCallback) {\n            originCallback(req.headers.origin, function (err, origin) {\n              if (err || !origin) {\n                next(err);\n              } else {\n                var corsOptions = Object.create(options);\n                corsOptions.origin = origin;\n                cors(corsOptions, req, res, next);\n              }\n            });\n          } else {\n            next();\n          }\n        }\n      });\n    };\n  }\n\n  // can pass either an options hash, an options delegate, or nothing\n  module.exports = middlewareWrapper;\n\n}());\n\n"]}