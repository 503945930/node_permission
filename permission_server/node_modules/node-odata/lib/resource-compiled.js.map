{"version":3,"sources":["resource.js"],"names":[],"mappings":"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","file":"resource-compiled.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\n\nvar _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }\n\nvar _lodash = require('lodash');\n\nvar _model = require('./model');\n\nvar _model2 = _interopRequireDefault(_model);\n\nvar _rest = require('./rest');\n\nvar _rest2 = _interopRequireDefault(_rest);\n\nvar Resource = (function () {\n  function Resource(name, model) {\n    _classCallCheck(this, Resource);\n\n    this._name = name;\n    this._url = name;\n    this._model = model;\n    this._hooks = {\n      list: {},\n      get: {},\n      post: {},\n      put: {},\n      'delete': {} };\n    this._actions = {};\n    this._options = {\n      maxTop: 10000,\n      maxSkip: 10000,\n      orderby: undefined };\n  }\n\n  _createClass(Resource, [{\n    key: 'action',\n    value: function action(url, fn, auth) {\n      this._actions[url] = fn;\n      this._actions[url].auth = auth;\n      return this;\n    }\n  }, {\n    key: 'maxTop',\n    value: function maxTop(count) {\n      this._maxTop = count;\n      return this;\n    }\n  }, {\n    key: 'maxSkip',\n    value: function maxSkip(count) {\n      this._maxSkip = count;\n      return this;\n    }\n  }, {\n    key: 'orderBy',\n    value: function orderBy(field) {\n      this._orderby = field;\n      return this;\n    }\n  }, {\n    key: 'list',\n    value: function list() {\n      this._currentMethod = 'list';\n      return this;\n    }\n  }, {\n    key: 'get',\n    value: function get() {\n      this._currentMethod = 'get';\n      return this;\n    }\n  }, {\n    key: 'post',\n    value: function post() {\n      this._currentMethod = 'post';\n      return this;\n    }\n  }, {\n    key: 'put',\n    value: function put() {\n      this._currentMethod = 'put';\n      return this;\n    }\n  }, {\n    key: 'delete',\n    value: function _delete() {\n      this._currentMethod = 'delete';\n      return this;\n    }\n  }, {\n    key: 'all',\n    value: function all() {\n      this._currentMethod = 'all';\n      return this;\n    }\n  }, {\n    key: 'before',\n    value: function before(fn) {\n      hook(this, 'before', fn);\n      return this;\n    }\n  }, {\n    key: 'after',\n    value: function after(fn) {\n      hook(this, 'after', fn);\n      return this;\n    }\n  }, {\n    key: 'auth',\n    value: function auth(fn) {\n      this._hooks[this._currentMethod].auth = fn;\n      return this;\n    }\n  }, {\n    key: 'url',\n    value: function url(_url) {\n      this._url = _url;\n      return this;\n    }\n  }, {\n    key: '_router',\n    value: function _router(db) {\n      var setting = arguments[1] === undefined ? {} : arguments[1];\n\n      // remove '/' if url is startwith it.\n      if (this._url.indexOf('/') === 0) {\n        this._url = this._url.substr(1);\n      }\n\n      // not allow contain '/' in url.\n      if (this._url.indexOf('/') >= 0) {\n        throw new Error('Url of resource[' + this._name + '] can\\'t contain \"/\", it can only be allowed to exist in the beginning.');\n      }\n\n      var mongooseModel = _model2['default'].register(db, this._url, this._model);\n\n      var params = {\n        url: this._url,\n        options: {\n          maxTop: (0, _lodash.min)([setting.maxTop, this._maxTop]),\n          maxSkip: (0, _lodash.min)([setting.maxSkip, this._maxSkip]),\n          orderby: this._orderby || setting.orderby },\n        hooks: this._hooks,\n        actions: this._actions };\n\n      return _rest2['default'].getRouter(mongooseModel, params);\n    }\n  }]);\n\n  return Resource;\n})();\n\nexports['default'] = Resource;\n\nfunction hook(resource, pos, fn) {\n  var method = resource._currentMethod;\n  if (method === 'all') {\n    method = ['get', 'post', 'put', 'delete', 'list'];\n  } else {\n    method = [method];\n  }\n  method.map(function (method) {\n    if (resource._hooks[method][pos]) {\n      (function () {\n        var _fn = resource._hooks[method][pos];\n        resource._hooks[method][pos] = function () {\n          for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n            args[_key] = arguments[_key];\n          }\n\n          _fn.apply(resource, args);\n          fn.apply(resource, args);\n        };\n      })();\n    } else {\n      resource._hooks[method][pos] = fn;\n    }\n  });\n}\nmodule.exports = exports['default'];"]}