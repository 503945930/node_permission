{"version":3,"sources":["list.js"],"names":[],"mappings":"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","file":"list-compiled.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }\n\nvar _parserCountParser = require('../parser/countParser');\n\nvar _parserCountParser2 = _interopRequireDefault(_parserCountParser);\n\nvar _parserFilterParser = require('../parser/filterParser');\n\nvar _parserFilterParser2 = _interopRequireDefault(_parserFilterParser);\n\nvar _parserOrderbyParser = require('../parser/orderbyParser');\n\nvar _parserOrderbyParser2 = _interopRequireDefault(_parserOrderbyParser);\n\nvar _parserSkipParser = require('../parser/skipParser');\n\nvar _parserSkipParser2 = _interopRequireDefault(_parserSkipParser);\n\nvar _parserTopParser = require('../parser/topParser');\n\nvar _parserTopParser2 = _interopRequireDefault(_parserTopParser);\n\nvar _parserSelectParser = require('../parser/selectParser');\n\nvar _parserSelectParser2 = _interopRequireDefault(_parserSelectParser);\n\nexports['default'] = function (req, MongooseModel, options) {\n  return new Promise(function (resolve, reject) {\n    var params = {\n      count: req.query.$count,\n      filter: req.query.$filter,\n      orderby: req.query.$orderby,\n      skip: req.query.$skip,\n      top: req.query.$top,\n      select: req.query.$select };\n\n    Promise.all([countQuery(MongooseModel, params), dataQuery(MongooseModel, params, options)]).then(function (results) {\n      var content = {};\n      results.map(function (result) {\n        if (result && result.key) {\n          content[result.key] = result.value;\n        }\n      });\n      resolve({ entity: content });\n    })['catch'](function (err) {\n      reject({ status: 500, text: err });\n    });\n  });\n};\n\nfunction countQuery(model, _ref) {\n  var count = _ref.count;\n  var filter = _ref.filter;\n\n  return new Promise(function (resolve, reject) {\n    (0, _parserCountParser2['default'])(model, count, filter).then(function (count) {\n      if (count !== undefined) {\n        resolve({ key: '@odata.count', value: count });\n      } else {\n        resolve();\n      }\n    })['catch'](function (err) {\n      reject(err);\n    });\n  });\n}\n\nfunction dataQuery(model, _ref2, options) {\n  var filter = _ref2.filter;\n  var orderby = _ref2.orderby;\n  var skip = _ref2.skip;\n  var top = _ref2.top;\n  var select = _ref2.select;\n\n  return new Promise(function (resolve, reject) {\n    var query = model.find();\n    (0, _parserFilterParser2['default'])(query, filter).then(function () {\n      (0, _parserOrderbyParser2['default'])(query, orderby || options.orderby);\n    }).then(function () {\n      (0, _parserSkipParser2['default'])(query, skip, options.maxSkip);\n    }).then(function () {\n      (0, _parserTopParser2['default'])(query, top, options.maxTop);\n    }).then(function () {\n      (0, _parserSelectParser2['default'])(query, select);\n    }).then(function () {\n      query.exec(function (err, data) {\n        if (err) {\n          return reject(err);\n        }\n        resolve({ key: 'value', value: data });\n      });\n    })['catch'](function (err) {\n      reject(err);\n    });\n  });\n}\nmodule.exports = exports['default'];\n\n// TODO expand: req.query.$expand,\n// TODO search: req.query.$search,"]}