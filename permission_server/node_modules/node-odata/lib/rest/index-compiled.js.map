{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }\n\nvar _http = require('http');\n\nvar _http2 = _interopRequireDefault(_http);\n\nvar _express = require('express');\n\nvar _list = require('./list');\n\nvar _list2 = _interopRequireDefault(_list);\n\nvar _post = require('./post');\n\nvar _post2 = _interopRequireDefault(_post);\n\nvar _put = require('./put');\n\nvar _put2 = _interopRequireDefault(_put);\n\nvar _delete = require('./delete');\n\nvar _delete2 = _interopRequireDefault(_delete);\n\nvar _get = require('./get');\n\nvar _get2 = _interopRequireDefault(_get);\n\nvar getRouter = function getRouter(mongooseModel, _ref) {\n  var url = _ref.url;\n  var hooks = _ref.hooks;\n  var actions = _ref.actions;\n  var options = _ref.options;\n\n  var resourceListURL = '/' + url;\n  var resourceURL = '' + resourceListURL + '\\\\(:id\\\\)';\n\n  var routes = [{\n    method: 'post',\n    url: resourceListURL,\n    ctrl: _post2['default'],\n    hook: hooks.post }, {\n    method: 'put',\n    url: resourceURL,\n    ctrl: _put2['default'],\n    hook: hooks.put }, {\n    method: 'delete',\n    url: resourceURL,\n    ctrl: _delete2['default'],\n    hook: hooks['delete'] }, {\n    method: 'get',\n    url: resourceURL,\n    ctrl: _get2['default'],\n    hook: hooks.get }, {\n    method: 'get',\n    url: resourceListURL,\n    ctrl: _list2['default'],\n    hook: hooks.list }];\n\n  var router = (0, _express.Router)();\n\n  // add REST routes.\n  routes.map(function (route) {\n    var method = route.method;\n    var url = route.url;\n    var ctrl = route.ctrl;\n    var hook = route.hook;\n\n    router[method](url, function (req, res, next) {\n      authorizePipe(req, res, hook.auth).then(function () {\n        return beforePipe(req, res, hook.before);\n      }).then(function () {\n        return ctrl(req, mongooseModel, options);\n      }).then(function (result) {\n        return respondPipe(req, res, result);\n      }).then(function (data) {\n        return afterPipe(req, res, hook.after, data);\n      })['catch'](function (result) {\n        errorPipe(req, res, result);\n      });\n    });\n  });\n\n  // add ACTION routes.\n  Object.keys(actions).map(function (url) {\n    var action = actions[url];\n    router.post('' + resourceURL + '' + url, function (req, res, next) {\n      authorizePipe(req, res, action.auth).then(function () {\n        action(req, res, next);\n      })['catch'](function (result) {\n        errorPipe(req, res, result);\n      });\n    });\n  });\n\n  return router;\n};\n\nfunction authorizePipe(req, res, auth) {\n  return new Promise(function (resolve, reject) {\n    if (auth !== undefined) {\n      if (!auth(req, res)) {\n        return reject({ status: 401 });\n      }\n    }\n    resolve();\n  });\n}\n\nfunction beforePipe(req, res, before) {\n  return new Promise(function (resolve, reject) {\n    if (before) {\n      before(req.body, req, res);\n    }\n    resolve();\n  });\n}\n\nfunction respondPipe(req, res, result) {\n  return new Promise(function (resolve, reject) {\n    var status = result.status || 200;\n    var data = result.entity;\n    res.status(status).jsonp(data);\n    resolve(data);\n  });\n}\n\nfunction afterPipe(req, res, after, data) {\n  return new Promise(function (resolve, reject) {\n    if (after) {\n      after(data, req.body, req, res);\n    }\n    resolve();\n  });\n}\n\nfunction errorPipe(req, res, result) {\n  return new Promise(function (resolve, reject) {\n    var status = result.status || 200;\n    var text = result.text || _http2['default'].STATUS_CODES[status];\n    res.status(status).send(text);\n  });\n}\n\nexports['default'] = { getRouter: getRouter };\nmodule.exports = exports['default'];"]}