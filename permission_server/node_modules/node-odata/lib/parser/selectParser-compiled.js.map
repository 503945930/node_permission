{"version":3,"sources":["selectParser.js"],"names":[],"mappings":"AAAA,YAAY,CAAC;;AAEb,MAAM,CAAC,cAAc,CAAC,OAAO,EAAE,YAAY,EAAE;AAC3C,OAAK,EAAE,IAAI;CACZ,CAAC,CAAC;;;;;AAKH,OAAO,CAAC,SAAS,CAAC,GAAG,UAAU,KAAK,EAAE,OAAO,EAAE;AAC7C,SAAO,IAAI,OAAO,CAAC,UAAU,OAAO,EAAE,MAAM,EAAE;AAC5C,QAAI,CAAC,OAAO,EAAE;AACZ,aAAO,OAAO,EAAE,CAAC;KAClB;;AAED,QAAI,IAAI,GAAG,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,UAAU,IAAI,EAAE;AAChD,aAAO,IAAI,CAAC,IAAI,EAAE,CAAC;KACpB,CAAC,CAAC;;AAEH,QAAI,YAAY,GAAG,EAAE,GAAG,EAAE,CAAC,EAAE,CAAC;AAC9B,QAAI,IAAI,GAAG,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC;AACnC,UAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,UAAU,IAAI,EAAE;AACpC,UAAI,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;AAC3B,YAAI,IAAI,KAAK,IAAI,EAAE;AACjB,sBAAY,CAAC,GAAG,GAAG,CAAC,CAAC;SACtB,MAAM,IAAI,OAAO,IAAI,CAAC,IAAI,CAAC,KAAK,UAAU,IAAI,IAAI,CAAC,IAAI,CAAC,CAAC,MAAM,KAAK,KAAK,EAAE;AAC1E,sBAAY,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;SACxB;OACF;KACF,CAAC,CAAC;;AAEH,QAAI,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,MAAM,KAAK,CAAC,IAAI,YAAY,CAAC,GAAG,KAAK,CAAC,EAAE;AACpE,aAAO,OAAO,EAAE,CAAC;KAClB;;AAED,SAAK,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;AAC3B,WAAO,EAAE,CAAC;GACX,CAAC,CAAC;CACJ,CAAC;;AAEF,MAAM,CAAC,OAAO,GAAG,OAAO,CAAC,SAAS,CAAC,CAAC","file":"selectParser-compiled.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\n// ?$select=Rating,ReleaseDate\n// ->\n// query.select('Rating ReleaseDate')\n\nexports['default'] = function (query, $select) {\n  return new Promise(function (resolve, reject) {\n    if (!$select) {\n      return resolve();\n    }\n\n    var list = $select.split(',').map(function (item) {\n      return item.trim();\n    });\n\n    var selectFields = { _id: 0 };\n    var tree = query.model.schema.tree;\n    Object.keys(tree).map(function (item) {\n      if (list.indexOf(item) >= 0) {\n        if (item === 'id') {\n          selectFields._id = 1;\n        } else if (typeof tree[item] === 'function' || tree[item].select !== false) {\n          selectFields[item] = 1;\n        }\n      }\n    });\n\n    if (Object.keys(selectFields).length === 1 && selectFields._id === 0) {\n      return resolve();\n    }\n\n    query.select(selectFields);\n    resolve();\n  });\n};\n\nmodule.exports = exports['default'];"]}