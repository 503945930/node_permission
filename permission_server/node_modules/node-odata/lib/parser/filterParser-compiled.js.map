{"version":3,"sources":["filterParser.js"],"names":[],"mappings":"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","file":"filterParser-compiled.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }\n\nfunction _slicedToArray(arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i['return']) _i['return'](); } finally { if (_d) throw _e; } } return _arr; } else { throw new TypeError('Invalid attempt to destructure non-iterable instance'); } }\n\n// Operator  Description             Example\n// Comparison Operators\n// eq        Equal                   Address/City eq 'Redmond'\n// ne        Not equal               Address/City ne 'London'\n// gt        Greater than            Price gt 20\n// ge        Greater than or equal   Price ge 10\n// lt        Less than               Price lt 20\n// le        Less than or equal      Price le 100\n// has       Has flags               Style has Sales.Color'Yellow'    #todo\n// Logical Operators\n// and       Logical and             Price le 200 and Price gt 3.5\n// or        Logical or              Price le 3.5 or Price gt 200     #todo\n// not       Logical negation        not endswith(Description,'milk') #todo\n\n// eg.\n//   http://host/service/Products?$filter=Price lt 10.00\n//   http://host/service/Categories?$filter=Products/$count lt 10\n\nvar _functionsParser = require('./functionsParser');\n\nvar _functionsParser2 = _interopRequireDefault(_functionsParser);\n\nexports['default'] = function (query, $filter) {\n  return new Promise(function (resolve, reject) {\n    if (!$filter) {\n      return resolve();\n    }\n\n    var SPLIT_MULTIPLE_CONDITIONS = /(.+?)(?:and(?=(?:[^']*'[^']*')*[^']*$)|$)/g;\n    var SPLIT_KEY_OPERATOR_AND_VALUE = /(.+?)(?: (?=(?:[^']*'[^']*')*[^']*$)|$)/g;\n\n    var condition = undefined;\n    if (stringHelper.has($filter, 'and')) {\n      condition = $filter.match(SPLIT_MULTIPLE_CONDITIONS).map(function (s) {\n        return stringHelper.removeEndOf(s, 'and').trim();\n      });\n    } else {\n      condition = [$filter.trim()];\n    }\n\n    condition.map(function (item) {\n      var conditionArr = item.match(SPLIT_KEY_OPERATOR_AND_VALUE).map(function (s) {\n        return s.trim();\n      }).filter(function (n) {\n        return n;\n      });\n      if (conditionArr.length !== 3) {\n        return reject('Syntax error at \\'' + item + '\\'.');\n      }\n\n      var _conditionArr = _slicedToArray(conditionArr, 3);\n\n      var key = _conditionArr[0];\n      var odataOperator = _conditionArr[1];\n      var value = _conditionArr[2];\n\n      var _validator$formatValue = validator.formatValue(value);\n\n      var val = _validator$formatValue.val;\n      var err = _validator$formatValue.err;\n\n      if (err) {\n        return reject(err);\n      }\n\n      // function query\n      var functionKey = key.substring(0, key.indexOf('('));\n      if (functionKey in { indexof: 1, year: 1 }) {\n        _functionsParser2['default'][functionKey](query, key, odataOperator, val);\n      } else {\n        // operator query\n        switch (odataOperator) {\n          case 'eq':\n            query.where(key).equals(val);\n            break;\n          case 'ne':\n            query.where(key).ne(val);\n            break;\n          case 'gt':\n            query.where(key).gt(val);\n            break;\n          case 'ge':\n            query.where(key).gte(val);\n            break;\n          case 'lt':\n            query.where(key).lt(val);\n            break;\n          case 'le':\n            query.where(key).lte(val);\n            break;\n          default:\n            return reject('Incorrect operator at \\'#{item}\\'.');\n        }\n      }\n    });\n    resolve();\n  });\n};\n\nvar stringHelper = {\n  has: function has(str, key) {\n    return str.indexOf(key) >= 0;\n  },\n\n  isBeginWith: function isBeginWith(str, key) {\n    return str.indexOf(key) === 0;\n  },\n\n  isEndWith: function isEndWith(str, key) {\n    return str.lastIndexOf(key) === str.length - key.length;\n  },\n\n  removeEndOf: function removeEndOf(str, key) {\n    if (stringHelper.isEndWith(str, key)) {\n      return str.substr(0, str.length - key.length);\n    }\n    return str;\n  } };\n\nvar validator = {\n  formatValue: function formatValue(value) {\n    if (value === 'true') {\n      value = true;\n    } else if (value === 'false') {\n      value = false;\n    } else if (+value === +value) {\n      value = +value;\n    } else if (stringHelper.isBeginWith(value, '\\'') && stringHelper.isEndWith(value, '\\'')) {\n      value = value.slice(1, -1);\n    } else {\n      return { err: 'Syntax error at \\'' + value + '\\'.' };\n    }\n    return { val: value };\n  }\n};\nmodule.exports = exports['default'];"]}