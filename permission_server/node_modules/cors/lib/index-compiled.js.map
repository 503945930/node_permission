{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["(function () {\n\n  'use strict';\n\n  var vary = require('vary');\n\n  var defaults = {\n      origin: '*',\n      methods: 'GET,HEAD,PUT,PATCH,POST,DELETE',\n      preflightContinue: false\n    };\n\n  function isString(s) {\n    return typeof s === 'string' || s instanceof String;\n  }\n\n  function isOriginAllowed(origin, allowedOrigin) {\n    if (Array.isArray(allowedOrigin)) {\n      for (var i = 0; i < allowedOrigin.length; ++i) {\n        if (isOriginAllowed(origin, allowedOrigin[i])) {\n          return true;\n        }\n      }\n      return false;\n    } else if (isString(allowedOrigin)) {\n      return origin === allowedOrigin;\n    } else if (allowedOrigin instanceof RegExp) {\n      return allowedOrigin.test(origin);\n    } else {\n      return !!allowedOrigin;\n    }\n  }\n\n  function configureOrigin(options, req) {\n    var requestOrigin = req.headers.origin,\n      headers = [],\n      isAllowed;\n\n    if (!options.origin || options.origin === '*') {\n      // allow any origin\n      headers.push([{\n        key: 'Access-Control-Allow-Origin',\n        value: '*'\n      }]);\n    } else if (isString(options.origin)) {\n      // fixed origin\n      headers.push([{\n        key: 'Access-Control-Allow-Origin',\n        value: options.origin\n      }]);\n      headers.push([{\n        key: 'Vary',\n        value: 'Origin'\n      }]);\n    } else {\n      isAllowed = isOriginAllowed(requestOrigin, options.origin);\n      // reflect origin\n      headers.push([{\n        key: 'Access-Control-Allow-Origin',\n        value: isAllowed ? requestOrigin : false\n      }]);\n      if (isAllowed) {\n        headers.push([{\n          key: 'Vary',\n          value: 'Origin'\n        }]);\n      }\n    }\n\n    return headers;\n  }\n\n  function configureMethods(options) {\n    var methods = options.methods || defaults.methods;\n    if (methods.join) {\n      methods = options.methods.join(','); // .methods is an array, so turn it into a string\n    }\n    return {\n      key: 'Access-Control-Allow-Methods',\n      value: methods\n    };\n  }\n\n  function configureCredentials(options) {\n    if (options.credentials === true) {\n      return {\n        key: 'Access-Control-Allow-Credentials',\n        value: 'true'\n      };\n    }\n    return null;\n  }\n\n  function configureAllowedHeaders(options, req) {\n    var headers = options.allowedHeaders || options.headers;\n    if (!headers) {\n      headers = req.headers['access-control-request-headers']; // .headers wasn't specified, so reflect the request headers\n    } else if (headers.join) {\n      headers = headers.join(','); // .headers is an array, so turn it into a string\n    }\n    if (headers && headers.length) {\n      return {\n        key: 'Access-Control-Allow-Headers',\n        value: headers\n      };\n    }\n    return null;\n  }\n\n  function configureExposedHeaders(options) {\n    var headers = options.exposedHeaders;\n    if (!headers) {\n      return null;\n    } else if (headers.join) {\n      headers = headers.join(','); // .headers is an array, so turn it into a string\n    }\n    if (headers && headers.length) {\n      return {\n        key: 'Access-Control-Expose-Headers',\n        value: headers\n      };\n    }\n    return null;\n  }\n\n  function configureMaxAge(options) {\n    var maxAge = options.maxAge && options.maxAge.toString();\n    if (maxAge && maxAge.length) {\n      return {\n        key: 'Access-Control-Max-Age',\n        value: maxAge\n      };\n    }\n    return null;\n  }\n\n  function applyHeaders(headers, res) {\n    for (var i = 0, n = headers.length; i < n; i++) {\n      var header = headers[i];\n      if (header) {\n        if (Array.isArray(header)) {\n          applyHeaders(header, res);\n        } else if (header.key === 'Vary' && header.value) {\n          vary(res, header.value);\n        } else if (header.value) {\n          res.setHeader(header.key, header.value);\n        }\n      }\n    }\n  }\n\n  function cors(options, req, res, next) {\n    var headers = [],\n      method = req.method && req.method.toUpperCase && req.method.toUpperCase();\n\n    if (method === 'OPTIONS') {\n      // preflight\n      headers.push(configureOrigin(options, req));\n      headers.push(configureCredentials(options, req));\n      headers.push(configureMethods(options, req));\n      headers.push(configureAllowedHeaders(options, req));\n      headers.push(configureMaxAge(options, req));\n      headers.push(configureExposedHeaders(options, req));\n      applyHeaders(headers, res);\n\n      if (options.preflightContinue ) {\n        next();\n      } else {\n        res.statusCode = 204;\n        res.end();\n      }\n    } else {\n      // actual response\n      headers.push(configureOrigin(options, req));\n      headers.push(configureCredentials(options, req));\n      headers.push(configureExposedHeaders(options, req));\n      applyHeaders(headers, res);\n      next();\n    }\n  }\n\n  function middlewareWrapper(o) {\n    // if no options were passed in, use the defaults\n    if (!o) {\n      o = {};\n    }\n    if (o.origin === undefined) {\n      o.origin = defaults.origin;\n    }\n    if (o.methods === undefined) {\n      o.methods = defaults.methods;\n    }\n    if (o.preflightContinue === undefined) {\n      o.preflightContinue = defaults.preflightContinue;\n    }\n\n    // if options are static (either via defaults or custom options passed in), wrap in a function\n    var optionsCallback = null;\n    if (typeof o === 'function') {\n      optionsCallback = o;\n    } else {\n      optionsCallback = function (req, cb) {\n        cb(null, o);\n      };\n    }\n\n    return function (req, res, next) {\n      optionsCallback(req, function (err, options) {\n        if (err) {\n          next(err);\n        } else {\n          var originCallback = null;\n          if (options.origin && typeof options.origin === 'function') {\n            originCallback = options.origin;\n          } else if (options.origin) {\n            originCallback = function (origin, cb) {\n              cb(null, options.origin);\n            };\n          }\n\n          if (originCallback) {\n            originCallback(req.headers.origin, function (err2, origin) {\n              if (err2 || !origin) {\n                next(err2);\n              } else {\n                var corsOptions = Object.create(options);\n                corsOptions.origin = origin;\n                cors(corsOptions, req, res, next);\n              }\n            });\n          } else {\n            next();\n          }\n        }\n      });\n    };\n  }\n\n  // can pass either an options hash, an options delegate, or nothing\n  module.exports = middlewareWrapper;\n\n}());\n"]}