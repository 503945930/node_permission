{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["/*!\n * morgan\n * Copyright(c) 2010 Sencha Inc.\n * Copyright(c) 2011 TJ Holowaychuk\n * Copyright(c) 2014 Jonathan Ong\n * Copyright(c) 2014-2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict'\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = morgan\nmodule.exports.compile = compile\nmodule.exports.format = format\nmodule.exports.token = token\n\n/**\n * Module dependencies.\n * @private\n */\n\nvar auth = require('basic-auth')\nvar debug = require('debug')('morgan')\nvar deprecate = require('depd')('morgan')\nvar onFinished = require('on-finished')\nvar onHeaders = require('on-headers')\n\n/**\n * Array of CLF month names.\n * @private\n */\n\nvar clfmonth = [\n  'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',\n  'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'\n]\n\n/**\n * Default log buffer duration.\n * @private\n */\n\nvar defaultBufferDuration = 1000;\n\n/**\n * Create a logger middleware.\n *\n * @public\n * @param {String|Function} format\n * @param {Object} [options]\n * @return {Function} middleware\n */\n\nfunction morgan(format, options) {\n  var fmt = format\n  var opts = options || {}\n\n  if (format && typeof format === 'object') {\n    opts = format\n    fmt = opts.format || 'default'\n\n    // smart deprecation message\n    deprecate('morgan(options): use morgan(' + (typeof fmt === 'string' ? JSON.stringify(fmt) : 'format') + ', options) instead')\n  }\n\n  if (fmt === undefined) {\n    deprecate('undefined format: specify a format')\n  }\n\n  // output on request instead of response\n  var immediate = opts.immediate\n\n  // check if log entry should be skipped\n  var skip = opts.skip || false\n\n  // format function\n  var formatLine = typeof fmt !== 'function'\n    ? getFormatFunction(fmt)\n    : fmt\n\n  // stream\n  var buffer = opts.buffer\n  var stream = opts.stream || process.stdout\n\n  // buffering support\n  if (buffer) {\n    deprecate('buffer option')\n\n    // flush interval\n    var interval = typeof buffer !== 'number'\n      ? defaultBufferDuration\n      : buffer\n\n    // swap the stream\n    stream = createBufferStream(stream, interval)\n  }\n\n  return function logger(req, res, next) {\n    // request data\n    req._startAt = undefined\n    req._startTime = undefined\n    req._remoteAddress = getip(req)\n\n    // response data\n    res._startAt = undefined\n    res._startTime = undefined\n\n    // record request start\n    recordStartTime.call(req)\n\n    function logRequest() {\n      if (skip !== false && skip(req, res)) {\n        debug('skip request')\n        return\n      }\n\n      var line = formatLine(morgan, req, res)\n\n      if (null == line) {\n        debug('skip line')\n        return\n      }\n\n      debug('log request')\n      stream.write(line + '\\n')\n    };\n\n    if (immediate) {\n      // immediate log\n      logRequest()\n    } else {\n      // record response start\n      onHeaders(res, recordStartTime)\n\n      // log when response finished\n      onFinished(res, logRequest)\n    }\n\n    next();\n  };\n}\n\n/**\n * Apache combined log format.\n */\n\nmorgan.format('combined', ':remote-addr - :remote-user [:date[clf]] \":method :url HTTP/:http-version\" :status :res[content-length] \":referrer\" \":user-agent\"')\n\n/**\n * Apache common log format.\n */\n\nmorgan.format('common', ':remote-addr - :remote-user [:date[clf]] \":method :url HTTP/:http-version\" :status :res[content-length]')\n\n/**\n * Default format.\n */\n\nmorgan.format('default', ':remote-addr - :remote-user [:date] \":method :url HTTP/:http-version\" :status :res[content-length] \":referrer\" \":user-agent\"')\ndeprecate.property(morgan, 'default', 'default format: use combined format')\n\n/**\n * Short format.\n */\n\nmorgan.format('short', ':remote-addr :remote-user :method :url HTTP/:http-version :status :res[content-length] - :response-time ms')\n\n/**\n * Tiny format.\n */\n\nmorgan.format('tiny', ':method :url :status :res[content-length] - :response-time ms')\n\n/**\n * dev (colored)\n */\n\nmorgan.format('dev', function developmentFormatLine(tokens, req, res) {\n  // get the status code if response written\n  var status = res._header\n    ? res.statusCode\n    : undefined\n\n  // get status color\n  var color = status >= 500 ? 31 // red\n    : status >= 400 ? 33 // yellow\n    : status >= 300 ? 36 // cyan\n    : status >= 200 ? 32 // green\n    : 0 // no color\n\n  // get colored function\n  var fn = developmentFormatLine[color]\n\n  if (!fn) {\n    // compile\n    fn = developmentFormatLine[color] = compile('\\x1b[0m:method :url \\x1b['\n      + color + 'm:status \\x1b[0m:response-time ms - :res[content-length]\\x1b[0m')\n  }\n\n  return fn(tokens, req, res)\n})\n\n/**\n * request url\n */\n\nmorgan.token('url', function getUrlToken(req) {\n  return req.originalUrl || req.url\n})\n\n/**\n * request method\n */\n\nmorgan.token('method', function getMethodToken(req) {\n  return req.method;\n});\n\n/**\n * response time in milliseconds\n */\n\nmorgan.token('response-time', function getResponseTimeToken(req, res) {\n  if (!req._startAt || !res._startAt) {\n    // missing request and/or response start time\n    return\n  }\n\n  // calculate diff\n  var ms = (res._startAt[0] - req._startAt[0]) * 1e3\n    + (res._startAt[1] - req._startAt[1]) * 1e-6\n\n  // return truncated value\n  return ms.toFixed(3)\n})\n\n/**\n * current date\n */\n\nmorgan.token('date', function getDateToken(req, res, format) {\n  var date = new Date()\n\n  switch (format || 'web') {\n    case 'clf':\n      return clfdate(date)\n    case 'iso':\n      return date.toISOString()\n    case 'web':\n      return date.toUTCString()\n  }\n});\n\n/**\n * response status code\n */\n\nmorgan.token('status', function getStatusToken(req, res) {\n  return res._header\n    ? String(res.statusCode)\n    : undefined\n})\n\n/**\n * normalized referrer\n */\n\nmorgan.token('referrer', function getReferrerToken(req) {\n  return req.headers['referer'] || req.headers['referrer'];\n});\n\n/**\n * remote address\n */\n\nmorgan.token('remote-addr', getip)\n\n/**\n * remote user\n */\n\nmorgan.token('remote-user', function getRemoteUserToken(req) {\n  // parse basic credentials\n  var credentials = auth(req)\n\n  // return username\n  return credentials\n    ? credentials.name\n    : undefined\n})\n\n/**\n * HTTP version\n */\n\nmorgan.token('http-version', function getHttpVersionToken(req) {\n  return req.httpVersionMajor + '.' + req.httpVersionMinor\n})\n\n/**\n * UA string\n */\n\nmorgan.token('user-agent', function getUserAgentToken(req) {\n  return req.headers['user-agent'];\n});\n\n/**\n * request header\n */\n\nmorgan.token('req', function getRequestToken(req, res, field) {\n  // get header\n  var header = req.headers[field.toLowerCase()]\n\n  return Array.isArray(header)\n    ? header.join(', ')\n    : header\n})\n\n/**\n * response header\n */\n\nmorgan.token('res', function getResponseTime(req, res, field) {\n  if (!res._header) {\n    return undefined\n  }\n\n  // get header\n  var header = res.getHeader(field)\n\n  return Array.isArray(header)\n    ? header.join(', ')\n    : header\n})\n\n/**\n * Format a Date in the common log format.\n *\n * @private\n * @param {Date} dateTime\n * @return {string}\n */\n\nfunction clfdate(dateTime) {\n  var date = dateTime.getUTCDate()\n  var hour = dateTime.getUTCHours()\n  var mins = dateTime.getUTCMinutes()\n  var secs = dateTime.getUTCSeconds()\n  var year = dateTime.getUTCFullYear()\n\n  var month = clfmonth[dateTime.getUTCMonth()]\n\n  return pad2(date) + '/' + month + '/' + year\n    + ':' + pad2(hour) + ':' + pad2(mins) + ':' + pad2(secs)\n    + ' +0000'\n}\n\n/**\n * Compile a format string into a function.\n *\n * @param {string} format\n * @return {function}\n * @public\n */\n\nfunction compile(format) {\n  if (typeof format !== 'string') {\n    throw new TypeError('argument format must be a string')\n  }\n\n  var fmt = format.replace(/\"/g, '\\\\\"')\n  var js = '  return \"' + fmt.replace(/:([-\\w]{2,})(?:\\[([^\\]]+)\\])?/g, function(_, name, arg) {\n    return '\"\\n    + (tokens[\"' + name + '\"](req, res, ' + String(JSON.stringify(arg)) + ') || \"-\") + \"'\n  }) + '\";'\n\n  return new Function('tokens, req, res', js)\n}\n\n/**\n * Create a basic buffering stream.\n *\n * @param {object} stream\n * @param {number} interval\n * @public\n */\n\nfunction createBufferStream(stream, interval) {\n  var buf = []\n  var timer = null\n\n  // flush function\n  function flush() {\n    timer = null\n    stream.write(buf.join(''))\n    buf.length = 0\n  }\n\n  // write function\n  function write(str) {\n    if (timer === null) {\n      timer = setTimeout(flush, interval)\n    }\n\n    buf.push(str)\n  }\n\n  // return a minimal \"stream\"\n  return { write: write }\n}\n\n/**\n * Define a format with the given name.\n *\n * @param {string} name\n * @param {string|function} fmt\n * @public\n */\n\nfunction format(name, fmt) {\n  morgan[name] = fmt\n  return this\n}\n\n/**\n * Lookup and compile a named format function.\n *\n * @param {string} name\n * @return {function}\n * @public\n */\n\nfunction getFormatFunction(name) {\n  // lookup format\n  var fmt = morgan[name] || name || morgan.default\n\n  // return compiled format\n  return typeof fmt !== 'function'\n    ? compile(fmt)\n    : fmt\n}\n\n/**\n * Get request IP address.\n *\n * @private\n * @param {IncomingMessage} req\n * @return {string}\n */\n\nfunction getip(req) {\n  return req.ip\n    || req._remoteAddress\n    || (req.connection && req.connection.remoteAddress)\n    || undefined;\n}\n\n/**\n * Pad number to two digits.\n *\n * @private\n * @param {number} num\n * @return {string}\n */\n\nfunction pad2(num) {\n  var str = String(num)\n\n  return (str.length === 1 ? '0' : '')\n    + str\n}\n\n/**\n * Record the start time.\n * @private\n */\n\nfunction recordStartTime() {\n  this._startAt = process.hrtime()\n  this._startTime = new Date()\n}\n\n/**\n * Define a token function with the given name,\n * and callback fn(req, res).\n *\n * @param {string} name\n * @param {function} fn\n * @public\n */\n\nfunction token(name, fn) {\n  morgan[name] = fn\n  return this\n}\n"]}