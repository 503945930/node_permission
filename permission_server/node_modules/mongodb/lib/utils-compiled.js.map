{"version":3,"sources":["utils.js"],"names":[],"mappings":"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","file":"utils-compiled.js","sourcesContent":["\"use strict\";\n\nvar MongoError = require('mongodb-core').MongoError\n\nvar shallowClone = function(obj) {\n  var copy = {};\n  for(var name in obj) copy[name] = obj[name];\n  return copy;\n}\n\n// Set simple property\nvar getSingleProperty = function(obj, name, value) {\n  Object.defineProperty(obj, name, {\n    enumerable:true,\n    get: function() {\n      return value \n    }\n  });  \n}\n\nvar formatSortValue = exports.formatSortValue = function(sortDirection) {\n  var value = (\"\" + sortDirection).toLowerCase();\n\n  switch (value) {\n    case 'ascending':\n    case 'asc':\n    case '1':\n      return 1;\n    case 'descending':\n    case 'desc':\n    case '-1':\n      return -1;\n    default:\n      throw new Error(\"Illegal sort clause, must be of the form \"\n                    + \"[['field1', '(ascending|descending)'], \"\n                    + \"['field2', '(ascending|descending)']]\");\n  }\n};\n\nvar formattedOrderClause = exports.formattedOrderClause = function(sortValue) {\n  var orderBy = {};\n  if(sortValue == null) return null;\n  if (Array.isArray(sortValue)) {\n    if(sortValue.length === 0) {\n      return null;\n    }\n\n    for(var i = 0; i < sortValue.length; i++) {\n      if(sortValue[i].constructor == String) {\n        orderBy[sortValue[i]] = 1;\n      } else {\n        orderBy[sortValue[i][0]] = formatSortValue(sortValue[i][1]);\n      }      \n    }\n  } else if(sortValue != null && typeof sortValue == 'object') {\n    orderBy = sortValue;\n  } else if (typeof sortValue == 'string') {\n    orderBy[sortValue] = 1;\n  } else {\n    throw new Error(\"Illegal sort clause, must be of the form \" +\n      \"[['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]\");\n  }\n\n  return orderBy;\n};\n\nvar checkCollectionName = function checkCollectionName (collectionName) {\n  if('string' !== typeof collectionName) {\n    throw Error(\"collection name must be a String\");\n  }\n\n  if(!collectionName || collectionName.indexOf('..') != -1) {\n    throw Error(\"collection names cannot be empty\");\n  }\n\n  if(collectionName.indexOf('$') != -1 &&\n      collectionName.match(/((^\\$cmd)|(oplog\\.\\$main))/) == null) {\n    throw Error(\"collection names must not contain '$'\");\n  }\n\n  if(collectionName.match(/^\\.|\\.$/) != null) {\n    throw Error(\"collection names must not start or end with '.'\");\n  }\n\n  // Validate that we are not passing 0x00 in the colletion name\n  if(!!~collectionName.indexOf(\"\\x00\")) {\n    throw new Error(\"collection names cannot contain a null character\");\n  }\n};\n\nvar handleCallback = function(callback, err, value1, value2) {\n  try {\n    if(callback == null) return;\n    if(value2) return callback(err, value1, value2);\n    return callback(err, value1);\n  } catch(err) {\n    process.nextTick(function() { throw err; });\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Wrap a Mongo error document in an Error instance\n * @ignore\n * @api private\n */\nvar toError = function(error) {\n  if (error instanceof Error) return error;\n\n  var msg = error.err || error.errmsg || error.errMessage || error;\n  var e = new MongoError(msg);\n\n  // Get all object keys\n  var keys = typeof error == 'object'\n    ? Object.keys(error)\n    : [];\n\n  for(var i = 0; i < keys.length; i++) {\n    e[keys[i]] = error[keys[i]];\n  }\n\n  return e;\n}\n\n/**\n * @ignore\n */\nvar normalizeHintField = function normalizeHintField(hint) {\n  var finalHint = null;\n\n  if(typeof hint == 'string') {\n    finalHint = hint;\n  } else if(Array.isArray(hint)) {\n    finalHint = {};\n\n    hint.forEach(function(param) {\n      finalHint[param] = 1;\n    });  \n  } else if(hint != null && typeof hint == 'object') {\n    finalHint = {};\n    for (var name in hint) {\n      finalHint[name] = hint[name];\n    }    \n  }\n\n  return finalHint;\n};\n\n/**\n * Create index name based on field spec\n *\n * @ignore\n * @api private\n */\nvar parseIndexOptions = function(fieldOrSpec) {\n  var fieldHash = {};\n  var indexes = [];\n  var keys;\n\n  // Get all the fields accordingly\n  if('string' == typeof fieldOrSpec) {\n    // 'type'\n    indexes.push(fieldOrSpec + '_' + 1);\n    fieldHash[fieldOrSpec] = 1;\n  } else if(Array.isArray(fieldOrSpec)) {\n    fieldOrSpec.forEach(function(f) {\n      if('string' == typeof f) {\n        // [{location:'2d'}, 'type']\n        indexes.push(f + '_' + 1);\n        fieldHash[f] = 1;\n      } else if(Array.isArray(f)) {\n        // [['location', '2d'],['type', 1]]\n        indexes.push(f[0] + '_' + (f[1] || 1));\n        fieldHash[f[0]] = f[1] || 1;\n      } else if(isObject(f)) {\n        // [{location:'2d'}, {type:1}]\n        keys = Object.keys(f);\n        keys.forEach(function(k) {\n          indexes.push(k + '_' + f[k]);\n          fieldHash[k] = f[k];\n        });\n      } else {\n        // undefined (ignore)\n      }\n    });\n  } else if(isObject(fieldOrSpec)) {\n    // {location:'2d', type:1}\n    keys = Object.keys(fieldOrSpec);\n    keys.forEach(function(key) {\n      indexes.push(key + '_' + fieldOrSpec[key]);\n      fieldHash[key] = fieldOrSpec[key];\n    });\n  }\n\n  return {\n    name: indexes.join(\"_\"), keys: keys, fieldHash: fieldHash\n  }\n}\n\nvar isObject = exports.isObject = function (arg) {\n  return '[object Object]' == toString.call(arg)\n}\n\nvar debugOptions = function(debugFields, options) {\n  var finaloptions = {};\n  debugFields.forEach(function(n) {\n    finaloptions[n] = options[n];\n  });\n\n  return finaloptions;\n}\n\nvar decorateCommand = function(command, options, exclude) {\n  for(var name in options) {\n    if(exclude[name] == null) command[name] = options[name];\n  }\n\n  return command;\n}\n\nexports.shallowClone = shallowClone;\nexports.getSingleProperty = getSingleProperty;\nexports.checkCollectionName = checkCollectionName;\nexports.toError = toError;\nexports.formattedOrderClause = formattedOrderClause;\nexports.parseIndexOptions = parseIndexOptions;\nexports.normalizeHintField = normalizeHintField;\nexports.handleCallback = handleCallback;\nexports.decorateCommand = decorateCommand;\nexports.isObject = isObject;\nexports.debugOptions = debugOptions;"]}