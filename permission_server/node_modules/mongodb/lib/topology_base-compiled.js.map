{"version":3,"sources":["topology_base.js"],"names":[],"mappings":"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","file":"topology_base-compiled.js","sourcesContent":["\"use strict\";\n\nvar MongoError = require('mongodb-core').MongoError\n  , f = require('util').format;\n\n// The store of ops\nvar Store = function(topology, storeOptions) {\n  var self = this;\n  var storedOps = [];\n  storeOptions = storeOptions || {force:false, bufferMaxEntries: -1}\n\n  // Internal state\n  this.s = {\n      storedOps: storedOps\n    , storeOptions: storeOptions\n    , topology: topology\n  }\n\n  Object.defineProperty(this, 'length', {\n    enumerable:true, get: function() { return self.s.storedOps.length; }\n  });\n}\n\nStore.prototype.add = function(opType, ns, ops, options, callback) {\n  if(this.s.storeOptions.force) return callback(new MongoError(\"db closed by application\"));\n  if(this.s.storeOptions.bufferMaxEntries == 0) return callback(new MongoError(f(\"no connection available for operation and number of stored operation > %s\", this.s.storeOptions.bufferMaxEntries)));\n  if(this.s.storeOptions.bufferMaxEntries > 0 && this.s.storedOps.length > this.s.storeOptions.bufferMaxEntries) {\n    while(this.s.storedOps.length > 0) {\n      var op = this.s.storedOps.shift();\n      op.c(new MongoError(f(\"no connection available for operation and number of stored operation > %s\", this.s.storeOptions.bufferMaxEntries)));\n    }\n\n    return;\n  }\n\n  this.s.storedOps.push({t: opType, n: ns, o: ops, op: options, c: callback})\n}\n\nStore.prototype.addObjectAndMethod = function(opType, object, method, params, callback) {\n  if(this.s.storeOptions.force) return callback(new MongoError(\"db closed by application\"));\n  if(this.s.storeOptions.bufferMaxEntries == 0) return callback(new MongoError(f(\"no connection available for operation and number of stored operation > %s\", this.s.storeOptions.bufferMaxEntries)));\n  if(this.s.storeOptions.bufferMaxEntries > 0 && this.s.storedOps.length > this.s.storeOptions.bufferMaxEntries) {\n    while(this.s.storedOps.length > 0) {\n      var op = this.s.storedOps.shift();\n      op.c(new MongoError(f(\"no connection available for operation and number of stored operation > %s\", this.s.storeOptions.bufferMaxEntries)));\n    }\n\n    return;\n  }\n\n  this.s.storedOps.push({t: opType, m: method, o: object, p: params, c: callback})\n}\n\nStore.prototype.flush = function() {\n  while(this.s.storedOps.length > 0) {\n    this.s.storedOps.shift().c(new MongoError(f(\"no connection available for operation\")));\n  }\n}\n\nStore.prototype.execute = function() {\n  // Get current ops\n  var ops = this.s.storedOps;\n  // Reset the ops\n  this.s.storedOps = [];\n\n  // Execute all the stored ops\n  while(ops.length > 0) {\n    var op = ops.shift();\n\n    if(op.t == 'cursor') {\n      op.o[op.m].apply(op.o, op.p);\n    } else {\n      this.s.topology[op.t](op.n, op.o, op.op, op.c);\n    }\n  }    \n}\n\nStore.prototype.all = function() {\n  return this.s.storedOps;\n}\n\n// Server capabilities\nvar ServerCapabilities = function(ismaster) {\n  var setup_get_property = function(object, name, value) {\n    Object.defineProperty(object, name, {\n        enumerable: true\n      , get: function () { return value; }\n    });  \n  }\n\n  // Capabilities\n  var aggregationCursor = false;\n  var writeCommands = false;\n  var textSearch = false;\n  var authCommands = false;\n  var listCollections = false;\n  var listIndexes = false;\n  var maxNumberOfDocsInBatch = ismaster.maxWriteBatchSize || 1000;\n\n  if(ismaster.minWireVersion >= 0) {\n    textSearch = true;\n  }\n\n  if(ismaster.maxWireVersion >= 1) {\n    aggregationCursor = true;\n    authCommands = true;\n  }\n\n  if(ismaster.maxWireVersion >= 2) {\n    writeCommands = true;\n  }\n\n  if(ismaster.maxWireVersion >= 3) {\n    listCollections = true;\n    listIndexes = true;\n  }\n\n  // If no min or max wire version set to 0\n  if(ismaster.minWireVersion == null) {\n    ismaster.minWireVersion = 0;\n  }\n\n  if(ismaster.maxWireVersion == null) {\n    ismaster.maxWireVersion = 0;\n  }\n\n  // Map up read only parameters\n  setup_get_property(this, \"hasAggregationCursor\", aggregationCursor);\n  setup_get_property(this, \"hasWriteCommands\", writeCommands);\n  setup_get_property(this, \"hasTextSearch\", textSearch);\n  setup_get_property(this, \"hasAuthCommands\", authCommands);\n  setup_get_property(this, \"hasListCollectionsCommand\", listCollections);\n  setup_get_property(this, \"hasListIndexesCommand\", listIndexes);\n  setup_get_property(this, \"minWireVersion\", ismaster.minWireVersion);\n  setup_get_property(this, \"maxWireVersion\", ismaster.maxWireVersion);\n  setup_get_property(this, \"maxNumberOfDocsInBatch\", maxNumberOfDocsInBatch);\n}\n\nexports.Store = Store;\nexports.ServerCapabilities = ServerCapabilities;"]}