{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["/*!\n * finalhandler\n * Copyright(c) 2014 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n/**\n * Module dependencies.\n */\n\nvar debug = require('debug')('finalhandler')\nvar escapeHtml = require('escape-html')\nvar http = require('http')\nvar onFinished = require('on-finished')\n\n/**\n * Variables.\n */\n\n/* istanbul ignore next */\nvar defer = typeof setImmediate === 'function'\n  ? setImmediate\n  : function(fn){ process.nextTick(fn.bind.apply(fn, arguments)) }\nvar isFinished = onFinished.isFinished\n\n/**\n * Module exports.\n */\n\nmodule.exports = finalhandler\n\n/**\n * Final handler:\n *\n * @param {Request} req\n * @param {Response} res\n * @param {Object} [options]\n * @return {Function}\n * @api public\n */\n\nfunction finalhandler(req, res, options) {\n  options = options || {}\n\n  // get environment\n  var env = options.env || process.env.NODE_ENV || 'development'\n\n  // get error callback\n  var onerror = options.onerror\n\n  return function (err) {\n    var msg\n\n    // ignore 404 on in-flight response\n    if (!err && res._header) {\n      debug('cannot 404 after headers sent')\n      return\n    }\n\n    // unhandled error\n    if (err) {\n      // default status code to 500\n      if (!res.statusCode || res.statusCode < 400) {\n        res.statusCode = 500\n      }\n\n      // respect err.status\n      if (err.status) {\n        res.statusCode = err.status\n      }\n\n      // production gets a basic error message\n      var msg = env === 'production'\n        ? http.STATUS_CODES[res.statusCode]\n        : err.stack || err.toString()\n      msg = escapeHtml(msg)\n        .replace(/\\n/g, '<br>')\n        .replace(/  /g, ' &nbsp;') + '\\n'\n    } else {\n      res.statusCode = 404\n      msg = 'Cannot ' + escapeHtml(req.method) + ' ' + escapeHtml(req.originalUrl || req.url) + '\\n'\n    }\n\n    debug('default %s', res.statusCode)\n\n    // schedule onerror callback\n    if (err && onerror) {\n      defer(onerror, err, req, res)\n    }\n\n    // cannot actually respond\n    if (res._header) {\n      return req.socket.destroy()\n    }\n\n    send(req, res, res.statusCode, msg)\n  }\n}\n\n/**\n * Send response.\n *\n * @param {IncomingMessage} req\n * @param {OutgoingMessage} res\n * @param {number} status\n * @param {string} body\n * @api private\n */\n\nfunction send(req, res, status, body) {\n  function write() {\n    res.statusCode = status\n\n    // security header for content sniffing\n    res.setHeader('X-Content-Type-Options', 'nosniff')\n\n    // standard headers\n    res.setHeader('Content-Type', 'text/html; charset=utf-8')\n    res.setHeader('Content-Length', Buffer.byteLength(body, 'utf8'))\n\n    if (req.method === 'HEAD') {\n      res.end()\n      return\n    }\n\n    res.end(body, 'utf8')\n  }\n\n  if (isFinished(req)) {\n    write()\n    return\n  }\n\n  // unpipe everything from the request\n  unpipe(req)\n\n  // flush the request\n  onFinished(req, write)\n  req.resume()\n}\n\n/**\n * Unpipe everything from a stream.\n *\n * @param {Object} stream\n * @api private\n */\n\n/* istanbul ignore next: implementation differs between versions */\nfunction unpipe(stream) {\n  if (typeof stream.unpipe === 'function') {\n    // new-style\n    stream.unpipe()\n    return\n  }\n\n  // Node.js 0.8 hack\n  var listener\n  var listeners = stream.listeners('close')\n\n  for (var i = 0; i < listeners.length; i++) {\n    listener = listeners[i]\n\n    if (listener.name !== 'cleanup' && listener.name !== 'onclose') {\n      continue\n    }\n\n    // invoke the listener\n    listener.call(stream)\n  }\n}\n"]}