{"version":3,"sources":["collection.js"],"names":[],"mappings":";;;;;;;AAKA,IAAI,kBAAkB,GAAG,OAAO,CAAC,kBAAkB,CAAC;IAChD,UAAU,GAAG,OAAO,CAAC,SAAS,CAAC,CAAC,UAAU;IAC1C,MAAM,GAAG,OAAO,CAAC,uBAAuB,CAAC;IACzC,KAAK,GAAG,OAAO,CAAC,aAAa,CAAC,CAAA;;;;;;;;;;;AAWlC,SAAS,gBAAgB,GAAI;AAC3B,MAAI,CAAC,UAAU,GAAG,IAAI,CAAC;AACvB,oBAAkB,CAAC,KAAK,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;CAC3C;;;;;;AAMD,gBAAgB,CAAC,SAAS,CAAC,SAAS,GAAG,kBAAkB,CAAC,SAAS,CAAC;;;;;;;;AAQpE,gBAAgB,CAAC,SAAS,CAAC,MAAM,GAAG,YAAY;AAC9C,MAAI,IAAI,GAAG,IAAI,CAAC;;;;;AAKhB,MAAI,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE;;AAE1B,WAAO,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;GACrD;;;AAGD,SAAO,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,EAAE,UAAU,GAAG,EAAE,CAAC,EAAE;AAC1D,QAAI,GAAG,EAAE,OAAO,QAAQ,CAAC,GAAG,CAAC,CAAC;;;AAG9B,QAAI,CAAC,IAAI,CAAC,EAAE,CAAC,eAAe,CAAC,EAAE,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC,OAAO,CAAC,UAAS,GAAG,EAAE,IAAI,EAAE;AAC5E,UAAI,GAAG,EAAE;AACP,eAAO,QAAQ,CAAC,GAAG,CAAC,CAAC;OACtB;AACD,UAAI,GAAG,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;AAClB,UAAI,MAAM,GAAG,CAAC,CAAC,GAAG,CAAC;;AAEnB,UAAI,MAAM,EAAE;AACV,YAAI,GAAG,CAAC,OAAO,IAAI,GAAG,CAAC,OAAO,CAAC,MAAM,EAAE;AACrC,kBAAQ,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;SACnB,MAAM;AACL,cAAI,GAAG,GAAG,gDAAgD,GAAE,IAAI,CAAC,IAAI,GAAE,MAAM,GACnE,yDAAyD,GACzD,qBAAqB,GACrB,yGAAyG,CAAA;AACnH,aAAG,GAAG,IAAI,KAAK,CAAC,GAAG,CAAC,CAAC;AACrB,kBAAQ,CAAC,GAAG,CAAC,CAAC;SACf;OACF,MAAM;;AAEL,YAAI,IAAI,GAAG,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;AACzC,YAAI,CAAC,MAAM,GAAG,IAAI,CAAC;AACnB,YAAI,CAAC,IAAI,CAAC,EAAE,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,EAAE,QAAQ,CAAC,CAAC;OAC1D;KACF,CAAC,CAAC;GACJ,CAAC,CAAC;;AAEH,WAAS,QAAQ,CAAE,GAAG,EAAE,UAAU,EAAE;AAClC,QAAI,GAAG,EAAE;;AAEP,UAAI,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC;KAC9B,MAAM;AACL,UAAI,CAAC,UAAU,GAAG,UAAU,CAAC;AAC7B,wBAAkB,CAAC,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;KAChD;GACF,CAAC;CACH,CAAC;;;;;;;;AAQF,gBAAgB,CAAC,SAAS,CAAC,OAAO,GAAG,YAAY;AAC/C,oBAAkB,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;CACjD,CAAC;;;;;;AAMF,KAAK,IAAI,CAAC,IAAI,UAAU,CAAC,SAAS,EAAE;AAClC,GAAC,UAAS,CAAC,EAAC;AACV,oBAAgB,CAAC,SAAS,CAAC,CAAC,CAAC,GAAG,YAAY;AAC1C,UAAI,IAAI,CAAC,MAAM,EAAE;AACf,YAAI,CAAC,QAAQ,CAAC,CAAC,EAAE,SAAS,CAAC,CAAC;AAC5B,eAAO;OACR;;AAED,UAAI,UAAU,GAAG,IAAI,CAAC,UAAU;UAC5B,IAAI,GAAG,SAAS;UAChB,IAAI,GAAG,IAAI;UACX,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC;;AAEzC,UAAI,KAAK,EAAE;AACT,YAAI,UAAU,KAAK,OAAO,KAAK,EAAE;AAC/B,eAAK,CAAC,KAAK,CAAC,KAAK,EACb,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,EAAE,IAAI,CAAC,MAAM,GAAC,CAAC,CAAC,CAAC,CAAC,CAAC;SAChE,MAAM;AACL,iBAAO,CAAC,KAAK,CAAC,+CAA+C,EACzD,IAAI,CAAC,IAAI,EACT,CAAC,EACD,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,EACd,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,EACd,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,EACd,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA;SACpB;OACF;;AAED,aAAO,UAAU,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;KAC9C,CAAC;GACH,CAAA,CAAE,CAAC,CAAC,CAAC;CACP;;;;;;AAMD,SAAS,KAAK,CAAE,GAAG,EAAE;AACnB,MAAI,IAAI,GAAG,OAAO,GAAG,CAAC;AACtB,MAAI,UAAU,KAAK,IAAI,IAAI,WAAW,KAAK,IAAI,EAAE,OAAO,EAAE,CAAC;AAC3D,SAAO,MAAM,CAAC,GAAG,CAAC,CAAC;CACpB;;;;;;AAMD,SAAS,MAAM,CAAE,GAAG,EAAE,GAAG,EAAE;AACzB,MAAI,CAAC,GAAG,KAAK,CAAC,KAAK,CAAC,GAAG,EAAE,EAAE,cAAc,EAAE,CAAC,EAAE,CAAC,CAAC;AAChD,MAAI,CAAC,EAAE;AACL,QAAI,QAAQ,KAAK,CAAC,CAAC,WAAW,CAAC,IAAI,EAAE;AACnC,OAAC,GAAG,iBAAiB,CAAC;KACvB,MAAM,IAAI,UAAU,KAAK,CAAC,CAAC,WAAW,CAAC,IAAI,EAAE;AAC5C,UAAI,cAAc,GAAG,YAAY,GAAG,CAAC,CAAC,WAAW,EAAE,GAAG,IAAI,CAAC;AAC3D,OAAC,GAAG,EAAE,OAAO,EAAE,mBAAW;AAAE,iBAAO,cAAc,CAAC;SAAE,EAAE,CAAC;KACxD,MAAM,IAAI,MAAM,KAAK,CAAC,CAAC,WAAW,CAAC,IAAI,EAAE;AACxC,UAAI,cAAc,GAAG,YAAY,GAAG,CAAC,CAAC,WAAW,EAAE,GAAG,IAAI,CAAC;AAC3D,OAAC,GAAG,EAAE,OAAO,EAAE,mBAAW;AAAE,iBAAO,cAAc,CAAC;SAAE,EAAE,CAAC;KACxD,MAAM,IAAI,QAAQ,KAAK,CAAC,CAAC,WAAW,CAAC,IAAI,EAAE;AAC1C,UAAI,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;AAC1B,UAAI,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC;AAC1B,UAAI,GAAG,CAAC;AACR,WAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,EAAE,EAAE,CAAC,EAAE;AAChC,WAAG,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;AACd,YAAI,CAAC,CAAC,GAAG,CAAC,EAAE;AACV,cAAI,QAAQ,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,WAAW,CAAC,IAAI,EAAE;AACxC,aAAC,CAAC,GAAG,CAAC,GAAG,iBAAiB,CAAC;WAC5B,MAAM,IAAI,QAAQ,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,WAAW,CAAC,IAAI,EAAE;AAC/C,aAAC,CAAC,GAAG,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC;WAC/B,MAAM,IAAI,UAAU,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,WAAW,CAAC,IAAI,EAAE;AACjD,aAAC,CAAC,UAAS,CAAC,EAAC;AACX,kBAAI,cAAc,GAAG,YAAY,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,WAAW,EAAE,GAAG,IAAI,CAAC;AAChE,eAAC,CAAC,GAAG,CAAC,GAAG,EAAE,OAAO,EAAE,mBAAW;AAAE,yBAAO,cAAc,CAAC;iBAAE,EAAE,CAAC;aAC7D,CAAA,CAAE,CAAC,CAAC,CAAA;WACN,MAAM,IAAI,MAAM,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,WAAW,CAAC,IAAI,EAAE;AAC7C,aAAC,CAAC,UAAS,CAAC,EAAC;AACX,kBAAI,cAAc,GAAG,YAAY,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,WAAW,EAAE,GAAG,IAAI,CAAC;AAChE,eAAC,CAAC,GAAG,CAAC,GAAG,EAAE,OAAO,EAAE,mBAAW;AAAE,yBAAO,cAAc,CAAC;iBAAE,EAAE,CAAC;aAC7D,CAAA,CAAE,CAAC,CAAC,CAAA;WACN,MAAM,IAAI,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE;AAChC,aAAC,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,UAAU,CAAC,EAAE;AAC/B,qBAAO,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC,CAAA;aACvB,CAAC,CAAC;WACJ;SACF;OACF;KACF;AACD,QAAI,GAAG,EAAE,OAAO,CAAC,CAAC;GACnB;;AAED,SAAO,OAAO,CAAC,MAAM,CAAC,CACnB,OAAO,CAAC,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,IAAI,CAAC,CAC3B,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC,CAClB,OAAO,CAAC,SAAS,EAAE,GAAG,CAAC,CAAA;CAC3B;;;;;;;;;;AAUD,gBAAgB,CAAC,SAAS,CAAC,UAAU,GAAG,gBAAgB,CAAC,SAAS,CAAC,gBAAgB,CAAC;;;;;;AAMpF,MAAM,CAAC,OAAO,GAAG,gBAAgB,CAAC","file":"collection-compiled.js","sourcesContent":["\n/*!\n * Module dependencies.\n */\n\nvar MongooseCollection = require('../../collection')\n  , Collection = require('mongodb').Collection\n  , STATES = require('../../connectionstate')\n  , utils = require('../../utils')\n\n/**\n * A [node-mongodb-native](https://github.com/mongodb/node-mongodb-native) collection implementation.\n *\n * All methods methods from the [node-mongodb-native](https://github.com/mongodb/node-mongodb-native) driver are copied and wrapped in queue management.\n *\n * @inherits Collection\n * @api private\n */\n\nfunction NativeCollection () {\n  this.collection = null;\n  MongooseCollection.apply(this, arguments);\n}\n\n/*!\n * Inherit from abstract Collection.\n */\n\nNativeCollection.prototype.__proto__ = MongooseCollection.prototype;\n\n/**\n * Called when the connection opens.\n *\n * @api private\n */\n\nNativeCollection.prototype.onOpen = function () {\n  var self = this;\n\n  // always get a new collection in case the user changed host:port\n  // of parent db instance when re-opening the connection.\n\n  if (!self.opts.capped.size) {\n    // non-capped\n    return self.conn.db.collection(self.name, callback);\n  }\n\n  // capped\n  return self.conn.db.collection(self.name, function (err, c) {\n    if (err) return callback(err);\n\n    // discover if this collection exists and if it is capped\n    self.conn.db.listCollections({ name: self.name }).toArray(function(err, docs) {\n      if (err) {\n        return callback(err);\n      }\n      var doc = docs[0];\n      var exists = !!doc;\n\n      if (exists) {\n        if (doc.options && doc.options.capped) {\n          callback(null, c);\n        } else {\n          var msg = 'A non-capped collection exists with the name: '+ self.name +'\\n\\n'\n                  + ' To use this collection as a capped collection, please '\n                  + 'first convert it.\\n'\n                  + ' http://www.mongodb.org/display/DOCS/Capped+Collections#CappedCollections-Convertingacollectiontocapped'\n          err = new Error(msg);\n          callback(err);\n        }\n      } else {\n        // create\n        var opts = utils.clone(self.opts.capped);\n        opts.capped = true;\n        self.conn.db.createCollection(self.name, opts, callback);\n      }\n    });\n  });\n\n  function callback (err, collection) {\n    if (err) {\n      // likely a strict mode error\n      self.conn.emit('error', err);\n    } else {\n      self.collection = collection;\n      MongooseCollection.prototype.onOpen.call(self);\n    }\n  };\n};\n\n/**\n * Called when the connection closes\n *\n * @api private\n */\n\nNativeCollection.prototype.onClose = function () {\n  MongooseCollection.prototype.onClose.call(this);\n};\n\n/*!\n * Copy the collection methods and make them subject to queues\n */\n\nfor (var i in Collection.prototype) {\n  (function(i){\n    NativeCollection.prototype[i] = function () {\n      if (this.buffer) {\n        this.addQueue(i, arguments);\n        return;\n      }\n\n      var collection = this.collection\n        , args = arguments\n        , self = this\n        , debug = self.conn.base.options.debug;\n\n      if (debug) {\n        if ('function' === typeof debug) {\n          debug.apply(debug\n            , [self.name, i].concat(utils.args(args, 0, args.length-1)));\n        } else {\n          console.error('\\x1B[0;36mMongoose:\\x1B[0m %s.%s(%s) %s %s %s'\n            , self.name\n            , i\n            , print(args[0])\n            , print(args[1])\n            , print(args[2])\n            , print(args[3]))\n        }\n      }\n\n      return collection[i].apply(collection, args);\n    };\n  })(i);\n}\n\n/*!\n * Debug print helper\n */\n\nfunction print (arg) {\n  var type = typeof arg;\n  if ('function' === type || 'undefined' === type) return '';\n  return format(arg);\n}\n\n/*!\n * Debug print helper\n */\n\nfunction format (obj, sub) {\n  var x = utils.clone(obj, { retainKeyOrder: 1 });\n  if (x) {\n    if ('Binary' === x.constructor.name) {\n      x = '[object Buffer]';\n    } else if ('ObjectID' === x.constructor.name) {\n      var representation = 'ObjectId(\"' + x.toHexString() + '\")';\n      x = { inspect: function() { return representation; } };\n    } else if ('Date' === x.constructor.name) {\n      var representation = 'new Date(\"' + x.toUTCString() + '\")';\n      x = { inspect: function() { return representation; } };\n    } else if ('Object' === x.constructor.name) {\n      var keys = Object.keys(x);\n      var numKeys = keys.length;\n      var key;\n      for (var i = 0; i < numKeys; ++i) {\n        key = keys[i];\n        if (x[key]) {\n          if ('Binary' === x[key].constructor.name) {\n            x[key] = '[object Buffer]';\n          } else if ('Object' === x[key].constructor.name) {\n            x[key] = format(x[key], true);\n          } else if ('ObjectID' === x[key].constructor.name) {\n            ;(function(x){\n              var representation = 'ObjectId(\"' + x[key].toHexString() + '\")';\n              x[key] = { inspect: function() { return representation; } };\n            })(x)\n          } else if ('Date' === x[key].constructor.name) {\n            ;(function(x){\n              var representation = 'new Date(\"' + x[key].toUTCString() + '\")';\n              x[key] = { inspect: function() { return representation; } };\n            })(x)\n          } else if (Array.isArray(x[key])) {\n            x[key] = x[key].map(function (o) {\n              return format(o, true)\n            });\n          }\n        }\n      }\n    }\n    if (sub) return x;\n  }\n\n  return require('util')\n    .inspect(x, false, 10, true)\n    .replace(/\\n/g, '')\n    .replace(/\\s{2,}/g, ' ')\n}\n\n/**\n * Retreives information about this collections indexes.\n *\n * @param {Function} callback\n * @method getIndexes\n * @api public\n */\n\nNativeCollection.prototype.getIndexes = NativeCollection.prototype.indexInformation;\n\n/*!\n * Module exports.\n */\n\nmodule.exports = NativeCollection;\n"]}